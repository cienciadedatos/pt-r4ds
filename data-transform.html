<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt" xml:lang="pt"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Hadley Wickham, Mine Çetinkaya-Rundel, e Garrett Grolemund">
<title>R para Ciência de Dados (2ª edição) - 3&nbsp; ✅ Transformação de dados</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./workflow-style.html" rel="next">
<link href="./workflow-basics.html" rel="prev">
<link href="./cover.jpg" rel="icon" type="image/jpeg">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Nenhum resultado",
    "search-matching-documents-text": "documentos correspondentes",
    "search-copy-link-title": "Copiar link para a busca",
    "search-hide-matches-text": "Esconder correspondências adicionais",
    "search-more-match-text": "mais correspondência neste documento",
    "search-more-matches-text": "mais correspondências neste documento",
    "search-clear-button-title": "Limpar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Procurar"
  }
}</script><script defer="" data-domain="r4ds.hadley.nz" src="https://plausible.io/js/plausible.js"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./whole-game.html">✅ Visão geral</a></li><li class="breadcrumb-item"><a href="./data-transform.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">✅ Transformação de dados</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">R para Ciência de Dados (2ª edição)</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/cienciadedatos/pt-r4ds/" title="Código fonte" class="quarto-navigation-tool px-1" aria-label="Código fonte"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Alternar modo de leitor">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Procurar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">✅ Boas-vindas</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface-2e.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">✅ Prefácio da segunda edição</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">✅ Introdução</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./whole-game.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">✅ Visão geral</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-visualize.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">✅ Visualização de dados</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">✅ Fluxo de Trabalho: básico</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-transform.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">✅ Transformação de dados</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow-style.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">✅ Fluxo de trabalho: estilo de código</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-tidy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">✅ Organizanção de dados (<em>data tidying</em>)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow-scripts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">✅ Fluxo de trabalho: scripts e projetos</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-import.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">✅ Importação de dados</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow-help.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">✅ Fluxo de trabalho: obtendo ajuda</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./visualize.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">✅ Visualizar</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./layers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">✅ Camadas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./EDA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Exploratory data analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./communication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Communication</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./transform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">✅ Transformar</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./logicals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">✅ Vetores lógicos</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./numbers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">✅ Números</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./strings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Strings</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./regexps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Regular expressions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./factors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">✅ Fatores</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datetimes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Dates and times</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missing-values.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">✅ Valores faltantes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./joins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Joins</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./import.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">✅ Importar</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spreadsheets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">✅ Planilhas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./databases.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">✅ Bancos de dados</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./arrow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">✅ Arrow</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rectangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Hierarchical data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./webscraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">✅ Raspagem de dados (<em>Web scraping</em>)</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./program.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">✅ Programar</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">✅ Funções</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./iteration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Iteration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./base-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">✅ Um guia para o R base</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./communicate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">✅ Comunicar</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">✅ Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quarto-formats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">✅ Formatos para Quarto</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Índice</h2>
   
  <ul>
<li>
<a href="#introdu%C3%A7%C3%A3o" id="toc-introdução" class="nav-link active" data-scroll-target="#introdu%C3%A7%C3%A3o"><span class="header-section-number">3.1</span> Introdução</a>
  <ul class="collapse">
<li><a href="#pr%C3%A9-requisitos" id="toc-pré-requisitos" class="nav-link" data-scroll-target="#pr%C3%A9-requisitos"><span class="header-section-number">3.1.1</span> Pré-requisitos</a></li>
  <li><a href="#voos-nycflights13" id="toc-voos-nycflights13" class="nav-link" data-scroll-target="#voos-nycflights13"><span class="header-section-number">3.1.2</span> Voos (nycflights13)</a></li>
  <li><a href="#b%C3%A1sico-do-dplyr" id="toc-básico-do-dplyr" class="nav-link" data-scroll-target="#b%C3%A1sico-do-dplyr"><span class="header-section-number">3.1.3</span> Básico do dplyr</a></li>
  </ul>
</li>
  <li>
<a href="#linhas-rows" id="toc-linhas-rows" class="nav-link" data-scroll-target="#linhas-rows"><span class="header-section-number">3.2</span> Linhas (rows)</a>
  <ul class="collapse">
<li><a href="#filter" id="toc-filter" class="nav-link" data-scroll-target="#filter"><span class="header-section-number">3.2.1</span> <code>filter()</code></a></li>
  <li><a href="#erros-comuns" id="toc-erros-comuns" class="nav-link" data-scroll-target="#erros-comuns"><span class="header-section-number">3.2.2</span> Erros comuns</a></li>
  <li><a href="#arrange" id="toc-arrange" class="nav-link" data-scroll-target="#arrange"><span class="header-section-number">3.2.3</span> <code>arrange()</code></a></li>
  <li><a href="#distinct" id="toc-distinct" class="nav-link" data-scroll-target="#distinct"><span class="header-section-number">3.2.4</span> <code>distinct()</code></a></li>
  <li><a href="#exerc%C3%ADcios" id="toc-exercícios" class="nav-link" data-scroll-target="#exerc%C3%ADcios"><span class="header-section-number">3.2.5</span> Exercícios</a></li>
  </ul>
</li>
  <li>
<a href="#colunas-columns" id="toc-colunas-columns" class="nav-link" data-scroll-target="#colunas-columns"><span class="header-section-number">3.3</span> Colunas (columns)</a>
  <ul class="collapse">
<li><a href="#sec-mutate" id="toc-sec-mutate" class="nav-link" data-scroll-target="#sec-mutate"><span class="header-section-number">3.3.1</span> <code>mutate()</code></a></li>
  <li><a href="#sec-select" id="toc-sec-select" class="nav-link" data-scroll-target="#sec-select"><span class="header-section-number">3.3.2</span> <code>select()</code></a></li>
  <li><a href="#rename" id="toc-rename" class="nav-link" data-scroll-target="#rename"><span class="header-section-number">3.3.3</span> <code>rename()</code></a></li>
  <li><a href="#relocate" id="toc-relocate" class="nav-link" data-scroll-target="#relocate"><span class="header-section-number">3.3.4</span> <code>relocate()</code></a></li>
  <li><a href="#exerc%C3%ADcios-1" id="toc-exercícios-1" class="nav-link" data-scroll-target="#exerc%C3%ADcios-1"><span class="header-section-number">3.3.5</span> Exercícios</a></li>
  </ul>
</li>
  <li><a href="#sec-the-pipe" id="toc-sec-the-pipe" class="nav-link" data-scroll-target="#sec-the-pipe"><span class="header-section-number">3.4</span> O pipe</a></li>
  <li>
<a href="#grupos-groups" id="toc-grupos-groups" class="nav-link" data-scroll-target="#grupos-groups"><span class="header-section-number">3.5</span> Grupos (groups)</a>
  <ul class="collapse">
<li><a href="#group_by" id="toc-group_by" class="nav-link" data-scroll-target="#group_by"><span class="header-section-number">3.5.1</span> <code>group_by()</code></a></li>
  <li><a href="#sec-summarize" id="toc-sec-summarize" class="nav-link" data-scroll-target="#sec-summarize"><span class="header-section-number">3.5.2</span> <code>summarize()</code></a></li>
  <li><a href="#as-fun%C3%A7%C3%B5es-slice_" id="toc-as-funções-slice_" class="nav-link" data-scroll-target="#as-fun%C3%A7%C3%B5es-slice_"><span class="header-section-number">3.5.3</span> As funções <code>slice_</code></a></li>
  <li><a href="#agrupando-por-m%C3%BAltiplas-vari%C3%A1veis" id="toc-agrupando-por-múltiplas-variáveis" class="nav-link" data-scroll-target="#agrupando-por-m%C3%BAltiplas-vari%C3%A1veis"><span class="header-section-number">3.5.4</span> Agrupando por múltiplas variáveis</a></li>
  <li><a href="#desagrupando" id="toc-desagrupando" class="nav-link" data-scroll-target="#desagrupando"><span class="header-section-number">3.5.5</span> Desagrupando</a></li>
  <li><a href="#by" id="toc-by" class="nav-link" data-scroll-target="#by"><span class="header-section-number">3.5.6</span> <code>.by</code></a></li>
  <li><a href="#exerc%C3%ADcios-2" id="toc-exercícios-2" class="nav-link" data-scroll-target="#exerc%C3%ADcios-2"><span class="header-section-number">3.5.7</span> Exercícios</a></li>
  </ul>
</li>
  <li><a href="#sec-sample-size" id="toc-sec-sample-size" class="nav-link" data-scroll-target="#sec-sample-size"><span class="header-section-number">3.6</span> Caso de estudo: agregados e tamanho de amostra</a></li>
  <li><a href="#resumo" id="toc-resumo" class="nav-link" data-scroll-target="#resumo"><span class="header-section-number">3.7</span> Resumo</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/cienciadedatos/pt-r4ds/edit/main/data-transform.qmd" class="toc-action"><i class="bi bi-github"></i>Editar essa página</a></li><li><a href="https://github.com/cienciadedatos/pt-r4ds/issues/new" class="toc-action"><i class="bi empty"></i>Criar uma issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./whole-game.html">✅ Visão geral</a></li><li class="breadcrumb-item"><a href="./data-transform.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">✅ Transformação de dados</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-data-transform" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">✅ Transformação de dados</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="introdução" class="level2" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="introdução">
<span class="header-section-number">3.1</span> Introdução</h2>
<p>Visualização de dados é uma ferramenta importante para gerar insights, mas é raro que você pegue os dados exatamente na forma que você precisa para fazer o gráfico que você quer. Geralmente você precisará criar algumas variáveis novas ou agregações para responder às perguntas com seus dados, ou talvez você precise apenas renomear as variáveis ou reordenar as observações para facilitar o trabalho com os dados. Você vai aprender a fazer tudo isso (e mais um pouco!) nesse capítulo, em que nós iremos lhe apresentar as possibilidades de transformações de dados utilizando o pacote <strong>dplyr</strong> e um novo conjunto de dados sobre vôos que partiram de Nova York em 2013.</p>
<p>O objetivo desse capítulo é te dar uma visão geral de todas as principais ferramentas para transformar um data frame. Começaremos com as funções que operam sobre as linhas e colunas de um data frame, em seguida voltaremos para falar mais um pouco sobre o <em>pipe</em>, que é uma importante ferramenta que você utilizará para combinar os verbos das transformações. Depois, iremos introduzir a habilidade de trabalhar com grupos. Finalizaremos o capítulo com um caso de estudo que demonstra todas essas funções em ação, e, mais tarde, voltaremos para vê-las em detalhe nos capítulos que seguem, quando começaremos a nos aprofundar em tipos mais específicos de dados (números, strings (de caracteres) e datas).</p>
<section id="pré-requisitos" class="level3" data-number="3.1.1"><h3 data-number="3.1.1" class="anchored" data-anchor-id="pré-requisitos">
<span class="header-section-number">3.1.1</span> Pré-requisitos</h3>
<p>Nesse capítulo focaremos no pacote dplyr, outro membro central do tidyverse. Ilustraremos as ideias principais utilizando dados do pacote dados, e visualizaremos com o ggplot2 para nos ajudar a entender os dados.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/cienciadedatos/dados">dados</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ── Attaching core tidyverse packages ───────────────────── tidyverse 2.0.0 ──</span></span>
<span><span class="co">#&gt; ✔ dplyr     1.1.4.9000     ✔ readr     2.1.5     </span></span>
<span><span class="co">#&gt; ✔ forcats   1.0.0          ✔ stringr   1.5.1     </span></span>
<span><span class="co">#&gt; ✔ ggplot2   3.5.0          ✔ tibble    3.2.1     </span></span>
<span><span class="co">#&gt; ✔ lubridate 1.9.3          ✔ tidyr     1.3.1     </span></span>
<span><span class="co">#&gt; ✔ purrr     1.0.2          </span></span>
<span><span class="co">#&gt; ── Conflicts ─────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">#&gt; ✖ dplyr::filter() masks stats::filter()</span></span>
<span><span class="co">#&gt; ✖ dplyr::lag()    masks stats::lag()</span></span>
<span><span class="co">#&gt; ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Preste bastante atenção às mensagens de conflito exibidas quando você carregar o tidyverse. Elas te indicam que o dplyr sobrescreve algumas funções do R base. Se você quiser utilizar a versão R base dessas funções depois de carregar o dplyr, você deverá usar seus nomes completos: <code><a href="https://rdrr.io/r/stats/filter.html">stats::filter()</a></code> e <code><a href="https://rdrr.io/r/stats/lag.html">stats::lag()</a></code>. Até agora nós basicamente ignoramos o pacote ao qual uma função pertence, pois na maioria das vezes isso não importava.</p>
<p>No entanto, conhecer o pacote pode te auxiliar na obtenção de ajuda e na busca por funções relacionadas, então quando for necessário sermos precisos a respeito de qual pacote uma função pertence, nós utilizaremos a mesma sintaxe que o R: <code>nomedopacote::nomedafuncao()</code>.</p>
</section><section id="voos-nycflights13" class="level3" data-number="3.1.2"><h3 data-number="3.1.2" class="anchored" data-anchor-id="voos-nycflights13">
<span class="header-section-number">3.1.2</span> Voos (nycflights13)</h3>
<p>Para explorar os verbos básicos do dplyr iremos utilizar a base de dados <code><a href="https://rdrr.io/pkg/dados/man/voos.html">dados::voos</a></code>. Essa base contém todos os 336.776 vôos que saíram da cidade de Nova Iorque em 2013. Esses dados vêm de um órgão de transporte dos EUA chamado <a href="http://www.transtats.bts.gov/DatabaseInfo.asp?DB_ID=120&amp;Link=0">Bureau of Transportation Statistics</a>, e estão documentados em <code><a href="https://rdrr.io/pkg/dados/man/voos.html">?dados::voos</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span></span>
<span><span class="co">#&gt; # A tibble: 336,776 × 19</span></span>
<span><span class="co">#&gt;     ano   mes   dia horario_saida saida_programada atraso_saida</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;         &lt;int&gt;            &lt;int&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  2013     1     1           517              515            2</span></span>
<span><span class="co">#&gt; 2  2013     1     1           533              529            4</span></span>
<span><span class="co">#&gt; 3  2013     1     1           542              540            2</span></span>
<span><span class="co">#&gt; 4  2013     1     1           544              545           -1</span></span>
<span><span class="co">#&gt; 5  2013     1     1           554              600           -6</span></span>
<span><span class="co">#&gt; 6  2013     1     1           554              558           -4</span></span>
<span><span class="co">#&gt; # ℹ 336,770 more rows</span></span>
<span><span class="co">#&gt; # ℹ 13 more variables: horario_chegada &lt;int&gt;, chegada_prevista &lt;int&gt;, …</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>voos</code> é um tibble, um tipo especial de data frame utilizado pelo tidyverse para evitar algumas “pegadinhas” comuns. A diferença principal entre tibbles e data frames é forma como tibbles são exibidos no console; eles foram pensados para grandes conjuntos de dados, então eles mostram apenas algumas das primeiras linhas e somente as colunas que cabem na tela. Existem algumas opções para visualizar tudo. Se você estiver utilizando o RStudio, o mais conveniente provavelmente é <code>View(voos)</code>, que vai abrir uma visualização interativa, com filtros e rolagem de tela. Caso não esteja, você pode utilizar <code>print(voos, width = Inf)</code> para mostrar todas as colunas, ou utilizar <code><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse()</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">voos</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 336,776</span></span>
<span><span class="co">#&gt; Columns: 19</span></span>
<span><span class="co">#&gt; $ ano              &lt;int&gt; 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 20…</span></span>
<span><span class="co">#&gt; $ mes              &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…</span></span>
<span><span class="co">#&gt; $ dia              &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…</span></span>
<span><span class="co">#&gt; $ horario_saida    &lt;int&gt; 517, 533, 542, 544, 554, 554, 555, 557, 557, 558, …</span></span>
<span><span class="co">#&gt; $ saida_programada &lt;int&gt; 515, 529, 540, 545, 600, 558, 600, 600, 600, 600, …</span></span>
<span><span class="co">#&gt; $ atraso_saida     &lt;dbl&gt; 2, 4, 2, -1, -6, -4, -5, -3, -3, -2, -2, -2, -2, -…</span></span>
<span><span class="co">#&gt; $ horario_chegada  &lt;int&gt; 830, 850, 923, 1004, 812, 740, 913, 709, 838, 753,…</span></span>
<span><span class="co">#&gt; $ chegada_prevista &lt;int&gt; 819, 830, 850, 1022, 837, 728, 854, 723, 846, 745,…</span></span>
<span><span class="co">#&gt; $ atraso_chegada   &lt;dbl&gt; 11, 20, 33, -18, -25, 12, 19, -14, -8, 8, -2, -3, …</span></span>
<span><span class="co">#&gt; $ companhia_aerea  &lt;chr&gt; "UA", "UA", "AA", "B6", "DL", "UA", "B6", "EV", "B…</span></span>
<span><span class="co">#&gt; $ voo              &lt;int&gt; 1545, 1714, 1141, 725, 461, 1696, 507, 5708, 79, 3…</span></span>
<span><span class="co">#&gt; $ codigo_cauda     &lt;chr&gt; "N14228", "N24211", "N619AA", "N804JB", "N668DN", …</span></span>
<span><span class="co">#&gt; $ origem           &lt;chr&gt; "EWR", "LGA", "JFK", "JFK", "LGA", "EWR", "EWR", "…</span></span>
<span><span class="co">#&gt; $ destino          &lt;chr&gt; "IAH", "IAH", "MIA", "BQN", "ATL", "ORD", "FLL", "…</span></span>
<span><span class="co">#&gt; $ tempo_voo        &lt;dbl&gt; 227, 227, 160, 183, 116, 150, 158, 53, 140, 138, 1…</span></span>
<span><span class="co">#&gt; $ distancia        &lt;dbl&gt; 1400, 1416, 1089, 1576, 762, 719, 1065, 229, 944, …</span></span>
<span><span class="co">#&gt; $ hora             &lt;dbl&gt; 5, 5, 5, 5, 6, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5, 6,…</span></span>
<span><span class="co">#&gt; $ minuto           &lt;dbl&gt; 15, 29, 40, 45, 0, 58, 0, 0, 0, 0, 0, 0, 0, 0, 0, …</span></span>
<span><span class="co">#&gt; $ data_hora        &lt;dttm&gt; 2013-01-01 05:00:00, 2013-01-01 05:00:00, 2013-01…</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Em ambas as visualizações, o nome das variáveis estão seguidos por abreviaturas que te indicam o tipo de cada variável: <code>&lt;int&gt;</code> para inteiros, <code>&lt;dbl&gt;</code> double<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> (números reais), <code>&lt;chr&gt;</code> para caracteres (strings) e <code>&lt;dttm&gt;</code> para date-time (data e tempo). Isso é importante pois as operações possíveis sobre uma coluna depende muito do seu “tipo”.</p>
</section><section id="básico-do-dplyr" class="level3" data-number="3.1.3"><h3 data-number="3.1.3" class="anchored" data-anchor-id="básico-do-dplyr">
<span class="header-section-number">3.1.3</span> Básico do dplyr</h3>
<p>Você está prestes a aprender os verbos (funções) primários do dplyr que já vão lhe permitir resolver a vasta maioria dos desafios de manipulação de dados. Mas antes de discutirir suas diferenças individuais, é importante destacar o que eles têm em comum:</p>
<ol type="1">
<li><p>O primeiro argumento é sempre um data frame.</p></li>
<li><p>Os demais argumentos geralmente descrevem sobre quais colunas a operação será executada, utilizando o nome das variáveis (sem aspas).</p></li>
<li><p>A saída é sempre um novo data frame.</p></li>
</ol>
<p>Pelo fato de cada verbo fazer bem apenas UMA coisa, a resolução de problemas complexos normalmente requer a combinação de múltiplos verbos. Fazemos isso utilizando o pipe: <code>|&gt;</code>.</p>
<p>Falaremos mais do pipe em <a href="#sec-the-pipe" class="quarto-xref"><span>Seção 3.4</span></a>, mas resumindo, o pipe recebe alguma coisa à sua esquerda e repassa essa coisa para a função à sua direita, de forma que <code>x |&gt; f(y)</code> seja equivalente a <code>f(x, y)</code>, e <code>x |&gt; f(y) |&gt; g(z)</code> seja equivalente a <code>g(f(x, y), z)</code>. A forma mais fácil de pronunciar o pipe é “então” (<em>“then”</em>). Isso torna possível pegar a visão geral do código abaixo, mesmo que você ainda não tenha aprendido os detalhes:</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">destino</span> <span class="op">==</span> <span class="st">"IAH"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ano</span>, <span class="va">mes</span>, <span class="va">dia</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    atraso_chegada <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">atraso_chegada</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Verbos do dplyr são organizados em quatro grupos baseados na estrutura sobre a qual operam: <strong>linhas</strong> (<em>rows</em>), <strong>colunas</strong> (<em>columns</em>), <strong>grupos</strong> (<em>groups</em>) ou <strong>tabelas</strong> (<em>tables</em>). Nas próximas seções você aparenderá os verbos mais importantes para linhas, colunas e grupos, então voltaremos para os verbos de <em>join</em> que operam em tabelas na seção <a href="joins.html" class="quarto-xref"><span>Capítulo 19</span></a>. Vamos nessa!</p>
</section></section><section id="linhas-rows" class="level2" data-number="3.2"><h2 data-number="3.2" class="anchored" data-anchor-id="linhas-rows">
<span class="header-section-number">3.2</span> Linhas (rows)</h2>
<p>Os verbos mais importantes que operam nas linhas de um conjunto de dados são <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>, que modifica quais linhas estão presentes sem mudar a sua ordem, e <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code>, que modifica a ordem das linhas sem modificar quais estão presentes. Ambas as funções afetam apenas as linhas e as colunas permanecem intocadas. Também vamos falar sobre <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code>, que acha as linhas com valores únicos, mas diferentemente de <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> e <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> também pode, opcionalmente, modificar as colunas.</p>
<section id="filter" class="level3" data-number="3.2.1"><h3 data-number="3.2.1" class="anchored" data-anchor-id="filter">
<span class="header-section-number">3.2.1</span> <code>filter()</code>
</h3>
<p><code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> lhe permite manter linhas com base nos valores das colunas<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. O primeiro argumento é o data frame. O segundo e demais argumentos são as condições que devem ser verdadeiras para manter a linha. Por exemplo, podemos achar todos os vôos que decolaram com mais de 120 minutos (duas horas) de atraso:</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">atraso_saida</span> <span class="op">&gt;</span> <span class="fl">120</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 9,723 × 19</span></span>
<span><span class="co">#&gt;     ano   mes   dia horario_saida saida_programada atraso_saida</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;         &lt;int&gt;            &lt;int&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  2013     1     1           848             1835          853</span></span>
<span><span class="co">#&gt; 2  2013     1     1           957              733          144</span></span>
<span><span class="co">#&gt; 3  2013     1     1          1114              900          134</span></span>
<span><span class="co">#&gt; 4  2013     1     1          1540             1338          122</span></span>
<span><span class="co">#&gt; 5  2013     1     1          1815             1325          290</span></span>
<span><span class="co">#&gt; 6  2013     1     1          1842             1422          260</span></span>
<span><span class="co">#&gt; # ℹ 9,717 more rows</span></span>
<span><span class="co">#&gt; # ℹ 13 more variables: horario_chegada &lt;int&gt;, chegada_prevista &lt;int&gt;, …</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Assim como <code>&gt;</code> (maior que), você também pode usar <code>&gt;=</code> (maior ou igual a), <code>&lt;</code> (menor que), <code>&lt;=</code> (menor ou igual a), <code>==</code> (igual a), e <code>!=</code> (diferente de). Você também pode combinar condições com <code>&amp;</code> ou <code>,</code> para indicar “e” (avalia ambas as condições) ou com <code>|</code> para indicar “ou” (avalia ao menos uma condição):</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Voos que partiram no dia 1 de Janeiro</span></span>
<span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">mes</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">dia</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 842 × 19</span></span>
<span><span class="co">#&gt;     ano   mes   dia horario_saida saida_programada atraso_saida</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;         &lt;int&gt;            &lt;int&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  2013     1     1           517              515            2</span></span>
<span><span class="co">#&gt; 2  2013     1     1           533              529            4</span></span>
<span><span class="co">#&gt; 3  2013     1     1           542              540            2</span></span>
<span><span class="co">#&gt; 4  2013     1     1           544              545           -1</span></span>
<span><span class="co">#&gt; 5  2013     1     1           554              600           -6</span></span>
<span><span class="co">#&gt; 6  2013     1     1           554              558           -4</span></span>
<span><span class="co">#&gt; # ℹ 836 more rows</span></span>
<span><span class="co">#&gt; # ℹ 13 more variables: horario_chegada &lt;int&gt;, chegada_prevista &lt;int&gt;, …</span></span>
<span></span>
<span><span class="co"># Voos que partiram em janeiro ou fevereiro</span></span>
<span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">mes</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">mes</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 51,955 × 19</span></span>
<span><span class="co">#&gt;     ano   mes   dia horario_saida saida_programada atraso_saida</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;         &lt;int&gt;            &lt;int&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  2013     1     1           517              515            2</span></span>
<span><span class="co">#&gt; 2  2013     1     1           533              529            4</span></span>
<span><span class="co">#&gt; 3  2013     1     1           542              540            2</span></span>
<span><span class="co">#&gt; 4  2013     1     1           544              545           -1</span></span>
<span><span class="co">#&gt; 5  2013     1     1           554              600           -6</span></span>
<span><span class="co">#&gt; 6  2013     1     1           554              558           -4</span></span>
<span><span class="co">#&gt; # ℹ 51,949 more rows</span></span>
<span><span class="co">#&gt; # ℹ 13 more variables: horario_chegada &lt;int&gt;, chegada_prevista &lt;int&gt;, …</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Existe um atalho útil quando você está combinando <code>|</code> e <code>==</code>: <code>%in%</code>. Ele vai manter as linhas cujas variáveis são iguais a um dos valores à direita:</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Uma forma mais curta de selecionar vôos que decolaram em janeiro ou fevereiro</span></span>
<span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">mes</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 51,955 × 19</span></span>
<span><span class="co">#&gt;     ano   mes   dia horario_saida saida_programada atraso_saida</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;         &lt;int&gt;            &lt;int&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  2013     1     1           517              515            2</span></span>
<span><span class="co">#&gt; 2  2013     1     1           533              529            4</span></span>
<span><span class="co">#&gt; 3  2013     1     1           542              540            2</span></span>
<span><span class="co">#&gt; 4  2013     1     1           544              545           -1</span></span>
<span><span class="co">#&gt; 5  2013     1     1           554              600           -6</span></span>
<span><span class="co">#&gt; 6  2013     1     1           554              558           -4</span></span>
<span><span class="co">#&gt; # ℹ 51,949 more rows</span></span>
<span><span class="co">#&gt; # ℹ 13 more variables: horario_chegada &lt;int&gt;, chegada_prevista &lt;int&gt;, …</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vamos voltar para essas comparações e operadores lógicos com mais detalhes em <a href="logicals.html" class="quarto-xref"><span>Capítulo 12</span></a>.</p>
<p>Quando você roda <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> o dplyr executa a operação de filtragem, criando um novo data frame, e em seguida o exibe. Ele não modifica o conjunto de dados <code>voos</code> já existente, pois as funções do dplyr nunca modificam seus argumentos de entrada. Para salvar o resultado, você precisa utilizar o operador de atribuição <code>&lt;-</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">jan1</span> <span class="op">&lt;-</span> <span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">mes</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">dia</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="erros-comuns" class="level3" data-number="3.2.2"><h3 data-number="3.2.2" class="anchored" data-anchor-id="erros-comuns">
<span class="header-section-number">3.2.2</span> Erros comuns</h3>
<p>Quando você está começando com o R, o erro mais fácil de se cometer é utilizar <code>=</code> em vez de <code>==</code> quando se está testando igualdade. <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> vai te avisar quando isso acontecer:</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span>mes <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in `filter()`:</span></span>
<span><span class="co">#&gt; ! We detected a named input.</span></span>
<span><span class="co">#&gt; ℹ This usually means that you've used `=` instead of `==`.</span></span>
<span><span class="co">#&gt; ℹ Did you mean `mes == 1`?</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Outro erro é escrever as expressões com “ou” como faríamos em Português:</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">mes</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">|</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Isso até “funciona”, no sentido de que não retornará um erro, mas ele não vai fazer o que você esperaria, pois <code>|</code> primeiro vai avaliar a condição <code>mes == 1</code> e depois a condição <code>2</code>, que não é uma condição adequada para se avaliar nesse caso. Iremos aprender mais sobre o que está acontecendo aqui em <a href="regexps.html#sec-boolean-operations" class="quarto-xref"><span>Seção 15.6.2</span></a>.</p>
</section><section id="arrange" class="level3" data-number="3.2.3"><h3 data-number="3.2.3" class="anchored" data-anchor-id="arrange">
<span class="header-section-number">3.2.3</span> <code>arrange()</code>
</h3>
<p><code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> modifica a ordem das linhas com base no valor das colunas. Ela recebe um data frame e um conjunto de nomes de colunas (ou expressões mais complicadas) para ordenar por eles. Se você fornecer mais de um nome de coluna, cada coluna a mais será utilizada para desempatar os valores das colunas anteriores. Por exemplo, o código a seguir vai ordenar por horário da decolagem, que está distribuído em 4 colunas. Nós pegamos primeiro os anos mais antigos e então, dentro de cada ano, os primeiros meses e assim por diante.</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">ano</span>, <span class="va">mes</span>, <span class="va">dia</span>, <span class="va">horario_saida</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 336,776 × 19</span></span>
<span><span class="co">#&gt;     ano   mes   dia horario_saida saida_programada atraso_saida</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;         &lt;int&gt;            &lt;int&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  2013     1     1           517              515            2</span></span>
<span><span class="co">#&gt; 2  2013     1     1           533              529            4</span></span>
<span><span class="co">#&gt; 3  2013     1     1           542              540            2</span></span>
<span><span class="co">#&gt; 4  2013     1     1           544              545           -1</span></span>
<span><span class="co">#&gt; 5  2013     1     1           554              600           -6</span></span>
<span><span class="co">#&gt; 6  2013     1     1           554              558           -4</span></span>
<span><span class="co">#&gt; # ℹ 336,770 more rows</span></span>
<span><span class="co">#&gt; # ℹ 13 more variables: horario_chegada &lt;int&gt;, chegada_prevista &lt;int&gt;, …</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Você pode utilizar <code><a href="https://dplyr.tidyverse.org/reference/desc.html">desc()</a></code> em uma coluna dentro de <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> para re-ordenar o data frame com base naquele coluna em ordem decrescente (do maior para o menor). Por exemplo, esse código ordena os vôos do mais para os menos atrasados:</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">atraso_saida</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 336,776 × 19</span></span>
<span><span class="co">#&gt;     ano   mes   dia horario_saida saida_programada atraso_saida</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;         &lt;int&gt;            &lt;int&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  2013     1     9           641              900         1301</span></span>
<span><span class="co">#&gt; 2  2013     6    15          1432             1935         1137</span></span>
<span><span class="co">#&gt; 3  2013     1    10          1121             1635         1126</span></span>
<span><span class="co">#&gt; 4  2013     9    20          1139             1845         1014</span></span>
<span><span class="co">#&gt; 5  2013     7    22           845             1600         1005</span></span>
<span><span class="co">#&gt; 6  2013     4    10          1100             1900          960</span></span>
<span><span class="co">#&gt; # ℹ 336,770 more rows</span></span>
<span><span class="co">#&gt; # ℹ 13 more variables: horario_chegada &lt;int&gt;, chegada_prevista &lt;int&gt;, …</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Perceba que o número de linhas não se alterou – estamos apenas organizando os dados e não filtrando.</p>
</section><section id="distinct" class="level3" data-number="3.2.4"><h3 data-number="3.2.4" class="anchored" data-anchor-id="distinct">
<span class="header-section-number">3.2.4</span> <code>distinct()</code>
</h3>
<p><code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code> acha todas as linhas únicas em um conjunto de dados, então, do ponto de vista técnico ela opera principialmente nas linhas. No entanto, na maioria das vezes você vai querer combinações distintas de algumas variáveis, então você pode, opcionalmente, fornecer nome de colunas:</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Remove linhas duplicadas, se existirem </span></span>
<span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 336,776 × 19</span></span>
<span><span class="co">#&gt;     ano   mes   dia horario_saida saida_programada atraso_saida</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;         &lt;int&gt;            &lt;int&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  2013     1     1           517              515            2</span></span>
<span><span class="co">#&gt; 2  2013     1     1           533              529            4</span></span>
<span><span class="co">#&gt; 3  2013     1     1           542              540            2</span></span>
<span><span class="co">#&gt; 4  2013     1     1           544              545           -1</span></span>
<span><span class="co">#&gt; 5  2013     1     1           554              600           -6</span></span>
<span><span class="co">#&gt; 6  2013     1     1           554              558           -4</span></span>
<span><span class="co">#&gt; # ℹ 336,770 more rows</span></span>
<span><span class="co">#&gt; # ℹ 13 more variables: horario_chegada &lt;int&gt;, chegada_prevista &lt;int&gt;, …</span></span>
<span></span>
<span><span class="co"># Acha todos os pares únicos de origens e destinos</span></span>
<span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">origem</span>, <span class="va">destino</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 224 × 2</span></span>
<span><span class="co">#&gt;   origem destino</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt;  </span></span>
<span><span class="co">#&gt; 1 EWR    IAH    </span></span>
<span><span class="co">#&gt; 2 LGA    IAH    </span></span>
<span><span class="co">#&gt; 3 JFK    MIA    </span></span>
<span><span class="co">#&gt; 4 JFK    BQN    </span></span>
<span><span class="co">#&gt; 5 LGA    ATL    </span></span>
<span><span class="co">#&gt; 6 EWR    ORD    </span></span>
<span><span class="co">#&gt; # ℹ 218 more rows</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Por outro lado, caso você queira manter outras colunas quando estiver filtrando para linhas únicas, você pode usar a opção <code>.keep_all = TRUE</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">origem</span>, <span class="va">destino</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 224 × 19</span></span>
<span><span class="co">#&gt;     ano   mes   dia horario_saida saida_programada atraso_saida</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;         &lt;int&gt;            &lt;int&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  2013     1     1           517              515            2</span></span>
<span><span class="co">#&gt; 2  2013     1     1           533              529            4</span></span>
<span><span class="co">#&gt; 3  2013     1     1           542              540            2</span></span>
<span><span class="co">#&gt; 4  2013     1     1           544              545           -1</span></span>
<span><span class="co">#&gt; 5  2013     1     1           554              600           -6</span></span>
<span><span class="co">#&gt; 6  2013     1     1           554              558           -4</span></span>
<span><span class="co">#&gt; # ℹ 218 more rows</span></span>
<span><span class="co">#&gt; # ℹ 13 more variables: horario_chegada &lt;int&gt;, chegada_prevista &lt;int&gt;, …</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Não é uma coincidência que todos esses vôos distintos sejam em 1º de janeiro: <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code> irá achar a primeira ocorrência de uma linha única no conjunto de dados e decartar todas as demais.</p>
<p>Se, em vez disso, você quiser achar o número de ocorrências, é melhor trocar <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code> por <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code>, e com o argumento <code>sort = TRUE</code> você pode organizá-los em ordem decrescente do número de ocorrências. Você vai aprendar mais sobre contagens em <a href="numbers.html#sec-counts" class="quarto-xref"><span>Seção 13.3</span></a>.</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">origem</span>, <span class="va">destino</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 224 × 3</span></span>
<span><span class="co">#&gt;   origem destino     n</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt;   &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 JFK    LAX     11262</span></span>
<span><span class="co">#&gt; 2 LGA    ATL     10263</span></span>
<span><span class="co">#&gt; 3 LGA    ORD      8857</span></span>
<span><span class="co">#&gt; 4 JFK    SFO      8204</span></span>
<span><span class="co">#&gt; 5 LGA    CLT      6168</span></span>
<span><span class="co">#&gt; 6 EWR    ORD      6100</span></span>
<span><span class="co">#&gt; # ℹ 218 more rows</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="exercícios" class="level3" data-number="3.2.5"><h3 data-number="3.2.5" class="anchored" data-anchor-id="exercícios">
<span class="header-section-number">3.2.5</span> Exercícios</h3>
<ol type="1">
<li>
<p>Utilizando um único pipeline para cada condição, ache todos os vôos que cumpram a condição:</p>
<ul>
<li>Teve um atraso na chegada de duas ou mais horas</li>
<li>Voou para Houston (<code>IAH</code> ou <code>HOU</code>)</li>
<li>Foi operado pela United, American ou Delta</li>
<li>Decolou no verão<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> (julho, agosto e setembro)</li>
<li>Chegou com mais de duas horas de atraso, mas não teve atraso na decolagem.</li>
<li>Atrasou pelo menos uma hora, mas recuperou mais de 30 minutos em vôo.</li>
</ul>
</li>
<li><p>Ordene <code>voos</code> para achar os vôos com os maiores atrasos na decolagem. Ache os vôos que saíram o mais cedo pela manhã.</p></li>
<li><p>Ordene <code>voos</code> para achar os vôos mais rápidos. (Dica: tente incluir algum cálculo matemático dentro da sua função.)</p></li>
<li><p>Houve pelo menos um vôo em cada dia de 2013?</p></li>
<li><p>Quais vôos percorream as maiores distâncias? Quais percorreram as menores?</p></li>
<li><p>Faz diferença a ordem em que você usa <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> e <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> se você estiver utilizando ambos? Por que/por que não? Reflita sobre os resultados e quanto trabalho as funções teriam que executar.</p></li>
</ol></section></section><section id="colunas-columns" class="level2" data-number="3.3"><h2 data-number="3.3" class="anchored" data-anchor-id="colunas-columns">
<span class="header-section-number">3.3</span> Colunas (columns)</h2>
<p>Existem quatro verbos importantes que afetam as colunas sem modificar as linhas: <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> cria novas colunas que são derivadas das colunas existentes, <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> alteram as colunas que estão presentes, <code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code> modifica o nome das colunas e <code><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate()</a></code> modifica as posições das colunas.</p>
<section id="sec-mutate" class="level3" data-number="3.3.1"><h3 data-number="3.3.1" class="anchored" data-anchor-id="sec-mutate">
<span class="header-section-number">3.3.1</span> <code>mutate()</code>
</h3>
<p>O papel de <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> é adicionar novas colunas que são calculadas a partir de colunas existentes. Nos capítulos sobre transformações, você aprenderá sobre um grande conjunto de funções que podem ser utilizadas para manipular diferentes tipos de variáveis. Por enquanto, vamos nos ater à álgebra básica, que nos permite calcular o <code>tempo_ganho</code>, ou seja, quanto tempo um vôo atrasado recuperou no ar, e a velocidade <code>velocidade</code> em milhas por hora:</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    tempo_ganho <span class="op">=</span> <span class="va">atraso_saida</span> <span class="op">-</span> <span class="va">atraso_chegada</span>,</span>
<span>    velocidade <span class="op">=</span> <span class="va">distancia</span> <span class="op">/</span> <span class="va">tempo_voo</span> <span class="op">*</span> <span class="fl">60</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 336,776 × 21</span></span>
<span><span class="co">#&gt;     ano   mes   dia horario_saida saida_programada atraso_saida</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;         &lt;int&gt;            &lt;int&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  2013     1     1           517              515            2</span></span>
<span><span class="co">#&gt; 2  2013     1     1           533              529            4</span></span>
<span><span class="co">#&gt; 3  2013     1     1           542              540            2</span></span>
<span><span class="co">#&gt; 4  2013     1     1           544              545           -1</span></span>
<span><span class="co">#&gt; 5  2013     1     1           554              600           -6</span></span>
<span><span class="co">#&gt; 6  2013     1     1           554              558           -4</span></span>
<span><span class="co">#&gt; # ℹ 336,770 more rows</span></span>
<span><span class="co">#&gt; # ℹ 15 more variables: horario_chegada &lt;int&gt;, chegada_prevista &lt;int&gt;, …</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Por padrão, <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> adiciona novas colunas à direita do seu conjunto de dados, o que torna difícil ver o que está acontecendo aqui. Podemos usar o argumento <code>.before</code> para, em vez disso, adicionar as variáveis à esquerda<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>:</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    tempo_ganho <span class="op">=</span> <span class="va">atraso_saida</span> <span class="op">-</span> <span class="va">atraso_chegada</span>,</span>
<span>    velocidade <span class="op">=</span> <span class="va">distancia</span> <span class="op">/</span> <span class="va">tempo_voo</span> <span class="op">*</span> <span class="fl">60</span>,</span>
<span>    .before <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 336,776 × 21</span></span>
<span><span class="co">#&gt;   tempo_ganho velocidade   ano   mes   dia horario_saida saida_programada</span></span>
<span><span class="co">#&gt;         &lt;dbl&gt;      &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;         &lt;int&gt;            &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1          -9       370.  2013     1     1           517              515</span></span>
<span><span class="co">#&gt; 2         -16       374.  2013     1     1           533              529</span></span>
<span><span class="co">#&gt; 3         -31       408.  2013     1     1           542              540</span></span>
<span><span class="co">#&gt; 4          17       517.  2013     1     1           544              545</span></span>
<span><span class="co">#&gt; 5          19       394.  2013     1     1           554              600</span></span>
<span><span class="co">#&gt; 6         -16       288.  2013     1     1           554              558</span></span>
<span><span class="co">#&gt; # ℹ 336,770 more rows</span></span>
<span><span class="co">#&gt; # ℹ 14 more variables: atraso_saida &lt;dbl&gt;, horario_chegada &lt;int&gt;, …</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>O <code>.</code> é um sinal que mostra que <code>.before</code> é um argumento da função e não o nome de uma terceira variável que estamos criando. Você também pode utilizar <code>.after</code> para adicionar após uma variável, e tanto com <code>.before</code> quanto com <code>.after</code> você pode utilizar o nome da variável em vez da posição. Por exemplo, nós podemos adicionar novas variáveis após <code>dia</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    tempo_ganho <span class="op">=</span> <span class="va">atraso_saida</span> <span class="op">-</span> <span class="va">atraso_chegada</span>,</span>
<span>    velocidade <span class="op">=</span> <span class="va">distancia</span> <span class="op">/</span> <span class="va">tempo_voo</span> <span class="op">*</span> <span class="fl">60</span>,</span>
<span>    .after <span class="op">=</span> <span class="va">dia</span></span>
<span>  <span class="op">)</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ou então, você pode controlar quais variáveis são mantidas com o argumento <code>.keep</code>. Um argumento particularmente útil é <code>"used"</code> que especifica que nós queremos manter apenas as colunas que estiveram envolvidas ou foram criadas pela etapa de <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>. Por exemplo, a saída a seguir conterá apenas as variáveis <code>atraso_saida</code>, <code>atraso_chegada</code>, <code>tempo_voo</code>, <code>tempo_ganho</code>, <code>horas</code> e <code>tempo_ganho_per_hour</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    tempo_ganho <span class="op">=</span> <span class="va">atraso_saida</span> <span class="op">-</span> <span class="va">atraso_chegada</span>,</span>
<span>    horas <span class="op">=</span> <span class="va">tempo_voo</span> <span class="op">/</span> <span class="fl">60</span>,</span>
<span>    tempo_ganho_por_hora <span class="op">=</span> <span class="va">tempo_ganho</span> <span class="op">/</span> <span class="va">horas</span>,</span>
<span>    .keep <span class="op">=</span> <span class="st">"used"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Perceba que, uma vez que nós não atribuímos o resultado da operação de volta a <code>voos</code>, as novas variáveis <code>tempo_ganho,</code> <code>horas</code> e <code>tempo_ganho_por_hora</code> serão apenas exibidas no console mas não serão armazenadas em um data frame. Se nós quisermos tê-las disponíveis em um data frame para usá-las no futuro, devemos pensar com cuidado a respeito de atribuir o resultado de volta a <code>voos</code>, sobrescrevendo o data frame original com muito mais variáveis, ou em um novo objeto. Normalmente, a resposta correta é utilizar um novo objeto, que será nomeado de forma informativa para indicar seu conteúdo, ex: <code>ganho_atraso</code>, mas você talvez tenha boas razões para sobrescrever <code>voos</code>.</p>
</section><section id="sec-select" class="level3" data-number="3.3.2"><h3 data-number="3.3.2" class="anchored" data-anchor-id="sec-select">
<span class="header-section-number">3.3.2</span> <code>select()</code>
</h3>
<p>Não é incomum obter conjuntos de dados com centenas ou até mesmo milhares de variáveis. Nessa situação, o primeiro desafio tende as ser focar apenas nas variáveis que você está interessado. <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> permite que você rapidamente dê um <em>zoom</em> (foque) em um subconjunto adequado utilizando operações baseadas no nome das variáveis:</p>
<ul>
<li>
<p>Seleciona colunas por nome:</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">ano</span>, <span class="va">mes</span>, <span class="va">dia</span><span class="op">)</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</li>
<li>
<p>Seleciona todas as colunas entre ano e dia (inclusos):</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">ano</span><span class="op">:</span><span class="va">dia</span><span class="op">)</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</li>
<li>
<p>Seleciona todas as colunas exceto aquelas entre ano e dia (inclusos):</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">!</span><span class="va">ano</span><span class="op">:</span><span class="va">dia</span><span class="op">)</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</li>
</ul>
<p>Historicamente, essa operação era feita com <code>-</code> em vez de <code>!</code>, então é provável que você veja isso por aí. Esses dois operadores servem ao mesmo propósito, mas com diferenças sutis no comportamento. Recomendamos usar <code>!</code> porque é lido como “não” e se combina bem com <code>&amp;</code> e <code>|</code>.</p>
<ul>
<li>
<p>Seleciona todas as colunas que são caracteres:</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</li>
</ul>
<p>Existe uma variedade de funções auxiliares que você pode utilizar junto com <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>:</p>
<ul>
<li>
<code>starts_with("abc")</code>: dá match em nomes que se iniciam com “abc”.</li>
<li>
<code>ends_with("xyz")</code>: dá match em nomes que terminam “xyz”.</li>
<li>
<code>contains("ijk")</code>: dá match em nomes que contém “ijk”.</li>
<li>
<code>num_range("x", 1:3)</code>: buscará <code>x1</code>, <code>x2</code> e <code>x3</code>.</li>
</ul>
<p>Confira <code><a href="https://dplyr.tidyverse.org/reference/select.html">?select</a></code> para mais detalhes. Uma vez que você saiba expressões regulares (o tópico de <a href="regexps.html" class="quarto-xref"><span>Capítulo 15</span></a>) você também poderá utilizar <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches()</a></code> para selecionar variáveis que são identificáveis por um dado padrão.</p>
<p>Você pode renomear variáveis à media que seleciona elas com <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> utilizando <code>=</code>. O novo nome aparece à esquerda do <code>=</code> e o nome antigo à direita:</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span>tail_num <span class="op">=</span> <span class="va">codigo_cauda</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 336,776 × 1</span></span>
<span><span class="co">#&gt;   tail_num</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   </span></span>
<span><span class="co">#&gt; 1 N14228  </span></span>
<span><span class="co">#&gt; 2 N24211  </span></span>
<span><span class="co">#&gt; 3 N619AA  </span></span>
<span><span class="co">#&gt; 4 N804JB  </span></span>
<span><span class="co">#&gt; 5 N668DN  </span></span>
<span><span class="co">#&gt; 6 N39463  </span></span>
<span><span class="co">#&gt; # ℹ 336,770 more rows</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="rename" class="level3" data-number="3.3.3"><h3 data-number="3.3.3" class="anchored" data-anchor-id="rename">
<span class="header-section-number">3.3.3</span> <code>rename()</code>
</h3>
<p>Se você quiser manter todas as variáveis disponíveis e quer renomear apenas algumas delas, você pode utilizar <code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code> em vez de <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>tail_num <span class="op">=</span> <span class="va">codigo_cauda</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 336,776 × 19</span></span>
<span><span class="co">#&gt;     ano   mes   dia horario_saida saida_programada atraso_saida</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;         &lt;int&gt;            &lt;int&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  2013     1     1           517              515            2</span></span>
<span><span class="co">#&gt; 2  2013     1     1           533              529            4</span></span>
<span><span class="co">#&gt; 3  2013     1     1           542              540            2</span></span>
<span><span class="co">#&gt; 4  2013     1     1           544              545           -1</span></span>
<span><span class="co">#&gt; 5  2013     1     1           554              600           -6</span></span>
<span><span class="co">#&gt; 6  2013     1     1           554              558           -4</span></span>
<span><span class="co">#&gt; # ℹ 336,770 more rows</span></span>
<span><span class="co">#&gt; # ℹ 13 more variables: horario_chegada &lt;int&gt;, chegada_prevista &lt;int&gt;, …</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Se você tem várias colunas com nomes inconsistentes e gostaria de manualmente consertá-las de uma vez, confira o pacote <code><a href="https://sfirke.github.io/janitor/reference/clean_names.html">janitor::clean_names()</a></code> que fornece alguns métodos úteis de limpeza.</p>
</section><section id="relocate" class="level3" data-number="3.3.4"><h3 data-number="3.3.4" class="anchored" data-anchor-id="relocate">
<span class="header-section-number">3.3.4</span> <code>relocate()</code>
</h3>
<p>Utilize <code><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate()</a></code> para mover as variáveis de lugar. Talvez você queira deixar variáveis relacionadas juntas ou mover variáveis importantes para a frente do data frame. Por padrão <code><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate()</a></code> já move as variáveis para a frente:</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">data_hora</span>, <span class="va">tempo_voo</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 336,776 × 19</span></span>
<span><span class="co">#&gt;   data_hora           tempo_voo   ano   mes   dia horario_saida</span></span>
<span><span class="co">#&gt;   &lt;dttm&gt;                  &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;         &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 2013-01-01 05:00:00       227  2013     1     1           517</span></span>
<span><span class="co">#&gt; 2 2013-01-01 05:00:00       227  2013     1     1           533</span></span>
<span><span class="co">#&gt; 3 2013-01-01 05:00:00       160  2013     1     1           542</span></span>
<span><span class="co">#&gt; 4 2013-01-01 05:00:00       183  2013     1     1           544</span></span>
<span><span class="co">#&gt; 5 2013-01-01 06:00:00       116  2013     1     1           554</span></span>
<span><span class="co">#&gt; 6 2013-01-01 05:00:00       150  2013     1     1           554</span></span>
<span><span class="co">#&gt; # ℹ 336,770 more rows</span></span>
<span><span class="co">#&gt; # ℹ 13 more variables: saida_programada &lt;int&gt;, atraso_saida &lt;dbl&gt;, …</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Você também pode especificar onde quer colocá-las utilizando <code>.before</code> e <code>.after</code>, assim como em <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">ano</span><span class="op">:</span><span class="va">horario_saida</span>, .after <span class="op">=</span> <span class="va">data_hora</span><span class="op">)</span></span>
<span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"cheg"</span><span class="op">)</span>, .before <span class="op">=</span> <span class="va">horario_saida</span><span class="op">)</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="exercícios-1" class="level3" data-number="3.3.5"><h3 data-number="3.3.5" class="anchored" data-anchor-id="exercícios-1">
<span class="header-section-number">3.3.5</span> Exercícios</h3>
<ol type="1">
<li><p>Compare <code>horario_saida</code>, <code>sched_horario_saida</code>, e <code>atraso_saida</code>. Como você esperaria que esses três números estivessem relacionados?</p></li>
<li><p>Esboce a maior quantidade possível de maneiras de selecionar <code>horario_saida</code>, <code>atraso_saida</code>, <code>arr_time</code>, e <code>atraso_chegada</code> a partir de <code>voos</code>.</p></li>
<li><p>O que acontece se você especificar o nome de uma mesma variável múltiplas vezes em uma chamada à <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>?</p></li>
<li>
<p>O que a função <code><a href="https://tidyselect.r-lib.org/reference/all_of.html">any_of()</a></code> faz? Por que ela pode ser útil se utilizada em conjunto com esse vetor?</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">variables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ano"</span>, <span class="st">"mes"</span>, <span class="st">"dia"</span>, <span class="st">"atraso_saida"</span>, <span class="st">"atraso_chegada"</span><span class="op">)</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</li>
<li>
<p>O resultado de rodar o código a seguir te surpreende de alguma forma? Como que que as funções auxiliares de seleção lidam, por padrão, com maiúsculas e minúsculas? Como você pode alterar esse padrão?</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"TEMPO"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</li>
<li><p>Renomeie <code>tempo_voo</code> para <code>tempo_voo_min</code> para indicar as unidades de medida e mova-a para o início do data frame.</p></li>
<li>
<p>Por que o código abaixo não funciona e o que o erro significa?</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">codigo_cauda</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">atraso_chegada</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in `arrange()`:</span></span>
<span><span class="co">#&gt; ℹ In argument: `..1 = atraso_chegada`.</span></span>
<span><span class="co">#&gt; Caused by error:</span></span>
<span><span class="co">#&gt; ! object 'atraso_chegada' not found</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</li>
</ol></section></section><section id="sec-the-pipe" class="level2" data-number="3.4"><h2 data-number="3.4" class="anchored" data-anchor-id="sec-the-pipe">
<span class="header-section-number">3.4</span> O pipe</h2>
<p>Nós te mostramos acima alguns exemplos simples do uso do pipe, mas o seu real poder emerge quando você começa a combinar múltiplos verbos. Por exemplo, imagine que você gostaria de achar os vôos mais rápidos do aeroporto IAH em Houston: você precisaria combinar <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> e <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">destino</span> <span class="op">==</span> <span class="st">"IAH"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>velocidade <span class="op">=</span> <span class="va">distancia</span> <span class="op">/</span> <span class="va">tempo_voo</span> <span class="op">*</span> <span class="fl">60</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">ano</span><span class="op">:</span><span class="va">dia</span>, <span class="va">horario_saida</span>, <span class="va">companhia_aerea</span>, <span class="va">voo</span>, <span class="va">velocidade</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">velocidade</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 7,198 × 7</span></span>
<span><span class="co">#&gt;     ano   mes   dia horario_saida companhia_aerea   voo velocidade</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;         &lt;int&gt; &lt;chr&gt;           &lt;int&gt;      &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  2013     7     9           707 UA                226       522.</span></span>
<span><span class="co">#&gt; 2  2013     8    27          1850 UA               1128       521.</span></span>
<span><span class="co">#&gt; 3  2013     8    28           902 UA               1711       519.</span></span>
<span><span class="co">#&gt; 4  2013     8    28          2122 UA               1022       519.</span></span>
<span><span class="co">#&gt; 5  2013     6    11          1628 UA               1178       515.</span></span>
<span><span class="co">#&gt; 6  2013     8    27          1017 UA                333       515.</span></span>
<span><span class="co">#&gt; # ℹ 7,192 more rows</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Mesmo que esse pipeline tenha quatro etapas, é fácil passar o olho e entendê-lo pois os verbos vêm no início de cada linha: começa com os dados de <code>voos</code>, então filtra (<em>filter</em>), então modifica (<em>mutate</em>), então seleciona (<em>select</em>), então ordena(<em>arrange</em>).</p>
<p>O que aconteceria se não tivéssemos o pipe? Poderíamos aninhar cada chamada de função dentro da chamada anterior:</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span></span>
<span>        <span class="va">voos</span>, </span>
<span>        <span class="va">destino</span> <span class="op">==</span> <span class="st">"IAH"</span></span>
<span>      <span class="op">)</span>,</span>
<span>      velocidade <span class="op">=</span> <span class="va">distancia</span> <span class="op">/</span> <span class="va">tempo_voo</span> <span class="op">*</span> <span class="fl">60</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="va">ano</span><span class="op">:</span><span class="va">dia</span>, <span class="va">horario_saida</span>, <span class="va">companhia_aerea</span>, <span class="va">voo</span>, <span class="va">velocidade</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">velocidade</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ou poderíamos utilizar um bando de objedos intermediários:</p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">voos</span>, <span class="va">destino</span> <span class="op">==</span> <span class="st">"IAH"</span><span class="op">)</span></span>
<span><span class="va">voos2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">voos1</span>, velocidade <span class="op">=</span> <span class="va">distancia</span> <span class="op">/</span> <span class="va">tempo_voo</span> <span class="op">*</span> <span class="fl">60</span><span class="op">)</span></span>
<span><span class="va">voos3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">voos2</span>, <span class="va">ano</span><span class="op">:</span><span class="va">dia</span>, <span class="va">horario_saida</span>, <span class="va">companhia_aerea</span>, <span class="va">voo</span>, <span class="va">velocidade</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">voos3</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">velocidade</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ainda que ambas as formas tenham o sua hora e lugar, o pipe geralmente produz o código de análise de dados que é mais fácil de escrever e ler.</p>
<p>Para adicionar o pipe ao seu código, recomendamos utilizar o atalho nativo do teclado: Ctrl/Cmd + Shift + M. Você terá que fazer uma mudança nas opções do RStudio para utilizar <code>|&gt;</code> em vez de <code>%&gt;%</code> conforme mostrado em <a href="#fig-pipe-options" class="quarto-xref">Figura&nbsp;<span>3.1</span></a>; mais sobre <code>%&gt;%</code> em breve.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-pipe-options" class="quarto-figure quarto-figure-center quarto-float anchored" alt="Captura de tela mostrando a opção &quot;Use native pipe operator&quot; que pode ser encontrada no painel &quot;Editing&quot; das opções de &quot;Code&quot;.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-pipe-options-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="screenshots/rstudio-pipe-options.png" class="img-fluid figure-img" alt="Captura de tela mostrando a opção &quot;Use native pipe operator&quot; que pode ser encontrada no painel &quot;Editing&quot; das opções de &quot;Code&quot;." width="616">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pipe-options-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.1: Para inserir <code>|&gt;</code>, certifique-se de que a opção “Use native pipe operator” está marcada.
</figcaption></figure>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
magrittr
</div>
</div>
<div class="callout-body-container callout-body">
<p>Se você vem utilizando o tidyverse há um tempo, você deve estar familiarizado com o pipe <code>%&gt;%</code> fornecido pelo pacote <strong>magrittr</strong>. O pacote magrittr está incluído nos pacotes principais do tidyverse, então você pode utilizar <code>%&gt;%</code> sempre que carregar o tidyverse:</p>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/cienciadedatos/dados">dados</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">mtcarros</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">cilindros</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para casos simples, <code>|&gt;</code> e <code>%&gt;%</code> se comportam de forma idêntica. Então por que recomendamos o pipe do R base? Primeiramente, porque o fato de ser parte do R base, significa que ele está sempre disponível para uso, mesmo que você não esteja utilizando o tidyverse. Em segundo lugar, <code>|&gt;</code> é bem mais simples que <code>%&gt;%</code>: nesse meio tempo entre a invenção do <code>%&gt;%</code> em 2014 e a inclusão do <code>|&gt;</code> no R 4.1.0 em 2021, aprendemos muita coisa sobre o pipe. Isso permitiu que a implementação no R base se livrasse de funcionalidades com usos pouco frequentes e menos importantes.</p>
</div>
</div>
</section><section id="grupos-groups" class="level2" data-number="3.5"><h2 data-number="3.5" class="anchored" data-anchor-id="grupos-groups">
<span class="header-section-number">3.5</span> Grupos (groups)</h2>
<p>Até aqui você aprendeu sobre funções que trabalham com linhas e colunas. dplyr se torna ainda mais poderoso quando você acrescenta a habilidade de trabalhar com grupos. Nessa seção, focaremos nas funções mais importantes: <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>, e a família de funções <em>slice</em>.</p>
<section id="group_by" class="level3" data-number="3.5.1"><h3 data-number="3.5.1" class="anchored" data-anchor-id="group_by">
<span class="header-section-number">3.5.1</span> <code>group_by()</code>
</h3>
<p>Utilize <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> para dividir o seu conjunto de dados em grupos que tenham algum significado para sua análise:</p>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">mes</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 336,776 × 19</span></span>
<span><span class="co">#&gt; # Groups:   mes [12]</span></span>
<span><span class="co">#&gt;     ano   mes   dia horario_saida saida_programada atraso_saida</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;         &lt;int&gt;            &lt;int&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  2013     1     1           517              515            2</span></span>
<span><span class="co">#&gt; 2  2013     1     1           533              529            4</span></span>
<span><span class="co">#&gt; 3  2013     1     1           542              540            2</span></span>
<span><span class="co">#&gt; 4  2013     1     1           544              545           -1</span></span>
<span><span class="co">#&gt; 5  2013     1     1           554              600           -6</span></span>
<span><span class="co">#&gt; 6  2013     1     1           554              558           -4</span></span>
<span><span class="co">#&gt; # ℹ 336,770 more rows</span></span>
<span><span class="co">#&gt; # ℹ 13 more variables: horario_chegada &lt;int&gt;, chegada_prevista &lt;int&gt;, …</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> não modifica seus dados mas, se você observar a saída de perto, você verá que a há uma indicação de que ela está agrupada (<em>“grouped by”</em>) mês (<code>Groups: mes [12]</code>). Isso significa que todas as operações subsequentes irão operar “por mês”. <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> adiciona essa funcionalidade agrupada (<em>“grouped”</em>) (referenciada como uma classe) ao data frame, que modifica o comportamento dos verbos subsequentes que são aplicados aos dados.</p>
</section><section id="sec-summarize" class="level3" data-number="3.5.2"><h3 data-number="3.5.2" class="anchored" data-anchor-id="sec-summarize">
<span class="header-section-number">3.5.2</span> <code>summarize()</code>
</h3>
<p>A operação agrupada mais importante é a sumarização (<em>“summary”</em>), que caso esteja sendo utilizada para calcular uma única sumarização estatística, reduz o data frame para ter apenas uma única linha para cada grupo.</p>
<p>No dplyr, essa operação é feita pela função <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code><a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>, como mostrado pelo exemplo a seguir, que calcula o atraso médio das decolagens por mês:</p>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">mes</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    atraso_medio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">atraso_saida</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 12 × 2</span></span>
<span><span class="co">#&gt;     mes atraso_medio</span></span>
<span><span class="co">#&gt;   &lt;int&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1           NA</span></span>
<span><span class="co">#&gt; 2     2           NA</span></span>
<span><span class="co">#&gt; 3     3           NA</span></span>
<span><span class="co">#&gt; 4     4           NA</span></span>
<span><span class="co">#&gt; 5     5           NA</span></span>
<span><span class="co">#&gt; 6     6           NA</span></span>
<span><span class="co">#&gt; # ℹ 6 more rows</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Uow! Alguma coisa deu errado e todos os nosso resultados viraram <code>NA</code>s (pronuncia-se “N-A”), que é o símbolo do R para valores ausentes. Isso ocorreu pois alguns dos vôos observados possuíam dados ausentes na coluna de atrasos, e por isso, quando calculamos a média incluindo esses valores, obtemos um <code>NA</code> como resultado. Voltaremos a falar de valores ausentes em detalhes em <a href="missing-values.html" class="quarto-xref"><span>Capítulo 18</span></a>, mas por enquanto, vamos pedir à função <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> para ignorar todos os valores ausentes definindo o argumento <code>na.rm</code> como <code>TRUE</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">mes</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    atraso <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">atraso_saida</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 12 × 2</span></span>
<span><span class="co">#&gt;     mes atraso</span></span>
<span><span class="co">#&gt;   &lt;int&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1   10.0</span></span>
<span><span class="co">#&gt; 2     2   10.8</span></span>
<span><span class="co">#&gt; 3     3   13.2</span></span>
<span><span class="co">#&gt; 4     4   13.9</span></span>
<span><span class="co">#&gt; 5     5   13.0</span></span>
<span><span class="co">#&gt; 6     6   20.8</span></span>
<span><span class="co">#&gt; # ℹ 6 more rows</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Você pode criar quantas sínteses quiser em uma única chamada à <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>. Você irá aprender várias sumarizações úteis nos próximos capítulos, mas uma que é muito útil é <code><a href="https://dplyr.tidyverse.org/reference/context.html">n()</a></code>, que retorna o número de linhas de cada grupo.</p>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">mes</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    atraso <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">atraso_saida</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 12 × 3</span></span>
<span><span class="co">#&gt;     mes atraso     n</span></span>
<span><span class="co">#&gt;   &lt;int&gt;  &lt;dbl&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1     1   10.0 27004</span></span>
<span><span class="co">#&gt; 2     2   10.8 24951</span></span>
<span><span class="co">#&gt; 3     3   13.2 28834</span></span>
<span><span class="co">#&gt; 4     4   13.9 28330</span></span>
<span><span class="co">#&gt; 5     5   13.0 28796</span></span>
<span><span class="co">#&gt; 6     6   20.8 28243</span></span>
<span><span class="co">#&gt; # ℹ 6 more rows</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Surpreendentemente, médias e contagens podem te levar longe em ciência de dados!</p>
</section><section id="as-funções-slice_" class="level3" data-number="3.5.3"><h3 data-number="3.5.3" class="anchored" data-anchor-id="as-funções-slice_">
<span class="header-section-number">3.5.3</span> As funções <code>slice_</code>
</h3>
<p>Existem cinco funções úteis que lhe permite extrair linhas específicas de dentro de cada grupo:</p>
<ul>
<li>
<code>df |&gt; slice_head(n = 1)</code> pega a primeira linha de cada grupo.</li>
<li>
<code>df |&gt; slice_tail(n = 1)</code> pega a última linha de cada grupo.</li>
<li>
<code>df |&gt; slice_min(x, n = 1)</code> pega a linha com o menor valor da coluna <code>x</code>.</li>
<li>
<code>df |&gt; slice_max(x, n = 1)</code> pega a linha com o maior valor da coluna <code>x</code>.</li>
<li>
<code>df |&gt; slice_sample(n = 1)</code> pega uma linha aleatória.</li>
</ul>
<p>Você pode variar <code>n</code> para selecionar mais do que uma linha, ou, em vez de usar <code>n =</code>, você pode usar <code>prop = 0.1</code> para selecionar (por exemplo) 10% das linhas de cada grupo. Por exemplo, o código a seguir acha os vôos que estão mais atrasados na chegada em cada destino.</p>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">destino</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max</a></span><span class="op">(</span><span class="va">atraso_chegada</span>, n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">destino</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 108 × 19</span></span>
<span><span class="co">#&gt; # Groups:   destino [105]</span></span>
<span><span class="co">#&gt;   destino   ano   mes   dia horario_saida saida_programada atraso_saida</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;         &lt;int&gt;            &lt;int&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 ABQ      2013     7    22          2145             2007           98</span></span>
<span><span class="co">#&gt; 2 ACK      2013     7    23          1139              800          219</span></span>
<span><span class="co">#&gt; 3 ALB      2013     1    25           123             2000          323</span></span>
<span><span class="co">#&gt; 4 ANC      2013     8    17          1740             1625           75</span></span>
<span><span class="co">#&gt; 5 ATL      2013     7    22          2257              759          898</span></span>
<span><span class="co">#&gt; 6 AUS      2013     7    10          2056             1505          351</span></span>
<span><span class="co">#&gt; # ℹ 102 more rows</span></span>
<span><span class="co">#&gt; # ℹ 12 more variables: horario_chegada &lt;int&gt;, chegada_prevista &lt;int&gt;, …</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Perceba que existem 105 destinos, mas obtivemos 108 linhas aqui. O que aconteceu? <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_min()</a></code> e <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max()</a></code> mantém os valores empatados, então <code>n = 1</code> significa “nos dê todas as linhas com o maior valor”. Se você quiser exatamente uma linha por grupo, você pode definir <code>with_ties = FALSE</code>.</p>
<p>Isso é similar a calcular o atraso máximo com <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>, mas você obtém toda a linha correspondente (ou linhas, se houver um empate) em vez de apenas uma síntese estatística.</p>
</section><section id="agrupando-por-múltiplas-variáveis" class="level3" data-number="3.5.4"><h3 data-number="3.5.4" class="anchored" data-anchor-id="agrupando-por-múltiplas-variáveis">
<span class="header-section-number">3.5.4</span> Agrupando por múltiplas variáveis</h3>
<p>Você pode criar grupos utilizando mais de uma variável. Por exemplo, podemos fazer um grupo para cada data.</p>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">por_dia</span> <span class="op">&lt;-</span> <span class="va">voos</span> <span class="op">|&gt;</span>  </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ano</span>, <span class="va">mes</span>, <span class="va">dia</span><span class="op">)</span></span>
<span><span class="va">por_dia</span></span>
<span><span class="co">#&gt; # A tibble: 336,776 × 19</span></span>
<span><span class="co">#&gt; # Groups:   ano, mes, dia [365]</span></span>
<span><span class="co">#&gt;     ano   mes   dia horario_saida saida_programada atraso_saida</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;         &lt;int&gt;            &lt;int&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  2013     1     1           517              515            2</span></span>
<span><span class="co">#&gt; 2  2013     1     1           533              529            4</span></span>
<span><span class="co">#&gt; 3  2013     1     1           542              540            2</span></span>
<span><span class="co">#&gt; 4  2013     1     1           544              545           -1</span></span>
<span><span class="co">#&gt; 5  2013     1     1           554              600           -6</span></span>
<span><span class="co">#&gt; 6  2013     1     1           554              558           -4</span></span>
<span><span class="co">#&gt; # ℹ 336,770 more rows</span></span>
<span><span class="co">#&gt; # ℹ 13 more variables: horario_chegada &lt;int&gt;, chegada_prevista &lt;int&gt;, …</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Quando você cria um sumário de um tibble agrupado por mais de uma variável, cada sumário remove a camada do último grupo. Na verdade, essa não era uma boa forma de fazer essa função funcionar, mas é difícil mudar agora sem quebrar códigos que já existem. Para tornar óbvio o que está acontecendo, o dplyr exibe uma mensagem que te diz como modificar esse comportamento:</p>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos_diarios</span> <span class="op">&lt;-</span> <span class="va">por_dia</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'ano', 'mes'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Se você acha que esse comportamente está adequado, você pode requisitá-lo explicitamente para que a mensagem seja suprimida:</p>
<div class="cell">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos_diarios</span> <span class="op">&lt;-</span> <span class="va">por_dia</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>    .groups <span class="op">=</span> <span class="st">"drop_last"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ou então, modifique o comportamento padrão definindo um valor diferente, por exemplo, <code>"drop"</code>, para descartar todos os agrupamentos ou <code>"keep"</code> para manter os mesmos grupos.</p>
</section><section id="desagrupando" class="level3" data-number="3.5.5"><h3 data-number="3.5.5" class="anchored" data-anchor-id="desagrupando">
<span class="header-section-number">3.5.5</span> Desagrupando</h3>
<p>Você também pode querer remover agrupamentos de um data frame sem utilizar <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>. Você pode fazer isso com <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">por_dia</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 336,776 × 19</span></span>
<span><span class="co">#&gt;     ano   mes   dia horario_saida saida_programada atraso_saida</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;         &lt;int&gt;            &lt;int&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  2013     1     1           517              515            2</span></span>
<span><span class="co">#&gt; 2  2013     1     1           533              529            4</span></span>
<span><span class="co">#&gt; 3  2013     1     1           542              540            2</span></span>
<span><span class="co">#&gt; 4  2013     1     1           544              545           -1</span></span>
<span><span class="co">#&gt; 5  2013     1     1           554              600           -6</span></span>
<span><span class="co">#&gt; 6  2013     1     1           554              558           -4</span></span>
<span><span class="co">#&gt; # ℹ 336,770 more rows</span></span>
<span><span class="co">#&gt; # ℹ 13 more variables: horario_chegada &lt;int&gt;, chegada_prevista &lt;int&gt;, …</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Agora, vamos ver o que acontece quando você tenta sumarizar um data frame desagrupado.</p>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">por_dia</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    atraso_medio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">atraso_saida</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>    voos <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 2</span></span>
<span><span class="co">#&gt;   atraso_medio   voos</span></span>
<span><span class="co">#&gt;          &lt;dbl&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1         12.6 336776</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Você obtém uma única linha, pois o dplyr trata todas as linhas de um data frame desagrupado como pertencentes a um único grupo.</p>
</section><section id="by" class="level3" data-number="3.5.6"><h3 data-number="3.5.6" class="anchored" data-anchor-id="by">
<span class="header-section-number">3.5.6</span> <code>.by</code>
</h3>
<p>dplyr 1.1.0 inclui uma nova e experimental sintaxe para agrupamentos por operação, trata-se do argumento <code>.by</code>. <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> e <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup()</a></code> não serão abandonados, mas você pode também utilizar <code>.by</code> para agrupar no âmbito de uma única operação:</p>
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    atraso <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">atraso_saida</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    .by <span class="op">=</span> <span class="va">mes</span></span>
<span>  <span class="op">)</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ou, se você quiser agrupar por múltiplas variáveis:</p>
<div class="cell">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    atraso <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">atraso_saida</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">origem</span>, <span class="va">destino</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>.by</code> funciona com todos os verbos e tem a vantagem de você não precisar utilizar o argumento <code>.groups</code> para suprimir a mensagem de agrupamento ou <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup()</a></code> quando já tiver terminado a operação.</p>
<p>Nós não focamos nessa sintaxe nesse capítulo pois ela era muito nova quando escrevemos o livro. No entanto, quisemos mencioná-la pois achamos que ela tem muito potencial e provavelmente se tonará bastante popular. Você pode ler mais sobre ela em <a href="https://www.tidyverse.org/blog/2023/02/dplyr-1-1-0-per-operation-grouping/">dplyr 1.1.0 blog post</a>.</p>
</section><section id="exercícios-2" class="level3" data-number="3.5.7"><h3 data-number="3.5.7" class="anchored" data-anchor-id="exercícios-2">
<span class="header-section-number">3.5.7</span> Exercícios</h3>
<ol type="1">
<li><p>Qual companhia aérea (<em>companhia_aerea</em>) possui a pior média de atrasos? Desafio: você consegue desenrolar os efeitos de aeroportos ruins vs.&nbsp;companhias ruins? Por que/por que não? (Dica: experimente usar <code>voos |&gt; group_by(companhia_aerea, destino) |&gt; summarize(n())</code>)</p></li>
<li><p>Ache os vôos que estão mais atrasados no momento da decolagem, a partir de cada destino.</p></li>
<li><p>Como os atrasaso variam ao longo do dia. Ilustre sua resposta com um gráfico.</p></li>
<li><p>O que acontece se você passar um <code>n</code> negativo para <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_min()</a></code> e funções similares?</p></li>
<li><p>Explique o que <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code> faz em termos dos verbos dplyr que você acabou de aprender. O que o argumento <code>sort</code> faz para a função <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code>?</p></li>
<li>
<p>Suponha que temos o pequeno data frame a seguir:</p>
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span>,</span>
<span>  z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"K"</span>, <span class="st">"K"</span>, <span class="st">"L"</span>, <span class="st">"L"</span>, <span class="st">"K"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="a">
<li>
<p>Escreva como você acha que será a saída, e em seguida confira se acertou e descreva o que <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> faz:</p>
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</li>
<li>
<p>Escreva como você acha que será a saída, e em seguida confira se acertou e descreva o que <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> faz. Comente também a respeito da diferença em relação ao <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> da parte (a):</p>
<div class="cell">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</li>
<li>
<p>Escreva como você acha que será a saída, e em seguida confira se acertou e descreva o que o seguinte pipeline faz:</p>
<div class="cell">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</li>
<li>
<p>Escreva como você acha que será a saída, e em seguida confira se acertou e descreva o que o seguinte pipeline faz. Em seguida, comente sobre o que a mensagem diz:</p>
<div class="cell">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">z</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</li>
<li>
<p>Escreva como você acha que será a saída, e em seguida confira se acertou e descreva o que o seguinte pipeline faz. Como a saída difere da saída da parte (d):</p>
<div class="cell">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">z</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</li>
<li>
<p>Escreva como você acha que será a saída, e em seguida confira se acertou e descreva o que cada pipeline faz: Em que os dois pipelines diferem?</p>
<div class="cell">
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">z</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">z</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>mean_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</li>
</ol>
</li>
</ol></section></section><section id="sec-sample-size" class="level2" data-number="3.6"><h2 data-number="3.6" class="anchored" data-anchor-id="sec-sample-size">
<span class="header-section-number">3.6</span> Caso de estudo: agregados e tamanho de amostra</h2>
<p>Sempre que você fizer alguma agregação, é sempre uma boa ideia incluir a contagem (<code><a href="https://dplyr.tidyverse.org/reference/context.html">n()</a></code>). Dessa foma, você pode se certificar que não está tirando conclusões baseadas em pequenas quantidades de dados. Vamos demonstrar isso com alguns dados de baseball do pacote dados. Especificamente, iremos comparar qual a proporção de vezes um jogador acertou a bola (<em>“hit”</em>) (<code>rebatidas_simples</code>) vs.&nbsp;o número de vezes que ele tentou colocar a bola em jogo (<code>vez_bastao</code>):</p>
<div class="cell">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rebatedores</span> <span class="op">&lt;-</span> <span class="fu">dados</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/dados/man/rebatedores.html">rebatedores</a></span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">id_jogador</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    performance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">rebatidas_simples</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">vez_bastao</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">vez_bastao</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">rebatedores</span></span>
<span><span class="co">#&gt; # A tibble: 20,469 × 3</span></span>
<span><span class="co">#&gt;   id_jogador performance     n</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;            &lt;dbl&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 aardsda01       0          4</span></span>
<span><span class="co">#&gt; 2 aaronha01       0.305  12364</span></span>
<span><span class="co">#&gt; 3 aaronto01       0.229    944</span></span>
<span><span class="co">#&gt; 4 aasedo01        0          5</span></span>
<span><span class="co">#&gt; 5 abadan01        0.0952    21</span></span>
<span><span class="co">#&gt; 6 abadfe01        0.111      9</span></span>
<span><span class="co">#&gt; # ℹ 20,463 more rows</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Quando montamos um gráfico da habilidade dos rebatedores (medidas pela média de acerto, <code>performance</code>) contra o número de oportunidades de acertar a bola (medidas pela númer de vezes ao bastão, <code>n</code>), é possível ver dois padrões:</p>
<ol type="1">
<li><p>A variação em <code>performance</code> é maior entre os jogadores que foram menos vezes ao bastão. A forma do gráfico é muito característica: sempre que você projetar no gráfico uma média (ou alguma outra sumarização estatística) vs.&nbsp;tamanho do grupo, você verá que a variação diminui à medida que o tamanho da amostra aumenta<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>.</p></li>
<li><p>Existe uma correlação positiva entre a habilidade (<code>performance</code>) e as oportunidades de acertar a bola (<code>n</code>), pois os times querem dar aos melhores jogadores o maior número de oportunidades de acertar a bola.</p></li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rebatedores</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fl">100</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">n</span>, y <span class="op">=</span> <span class="va">performance</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="data-transform_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid figure-img" alt="Um gráfico de dispersão do performance de rebatidas vs. oportunidades de rebatidas sobrepostas por uma linha suavizada. Performance média cresce agudamente a partir de 0.2 quando n é 1 até 0.25 quando n é ~1000. Performance média continua crescendo linearmente em uma inclinação muito mais suave atingindo ~0.3 quando n é ~15,000." width="576"></p>
</figure>
</div>
</div>
</div>
<p>Perceba o padrão conveniente de combinar ggplot2 e dplyr. Você só precisa lembrar de mudar do <code>|&gt;</code>, para processamento do conjunto de dados, para o <code>+</code> para adicionar camadas ao seu gráfico.</p>
<p>Isso também tem implicações importantes para ranqueamento. Se você simplesmente ordenar com <code>desc(performance)</code>, as pessoas com as melhoras médias de rebatidas serão claramente aquelas que tentaram botar a bola em jogo apenas algumas poucas vezes mas calhou de acertarem, esses não são necessariamente os jogadores mais hábeis:</p>
<div class="cell">
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rebatedores</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">performance</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 20,469 × 3</span></span>
<span><span class="co">#&gt;   id_jogador performance     n</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;            &lt;dbl&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 abramge01            1     1</span></span>
<span><span class="co">#&gt; 2 alberan01            1     1</span></span>
<span><span class="co">#&gt; 3 banisje01            1     1</span></span>
<span><span class="co">#&gt; 4 bartocl01            1     1</span></span>
<span><span class="co">#&gt; 5 bassdo01             1     1</span></span>
<span><span class="co">#&gt; 6 birasst01            1     2</span></span>
<span><span class="co">#&gt; # ℹ 20,463 more rows</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Você pode achar uma boa explicação sobre esse problema e como resolvê-lo em <a href="http://varianceexplained.org/r/empirical_bayes_baseball/" class="uri">http://varianceexplained.org/r/empirical_bayes_baseball/</a> e <a href="https://www.evanmiller.org/how-not-to-sort-by-average-rating.html" class="uri">https://www.evanmiller.org/how-not-to-sort-by-average-rating.html</a>.</p>
</section><section id="resumo" class="level2" data-number="3.7"><h2 data-number="3.7" class="anchored" data-anchor-id="resumo">
<span class="header-section-number">3.7</span> Resumo</h2>
<p>Nesse capítulo, você aprendeu a usar as ferramentas que o pacote dplyr fornece para trabalhar com data frames.</p>
<p>Podemos considerar que elas estão agrupadas em três categorias: as que manipulam as linhas (como <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> e <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code>, as que manipulam colunas (como <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> e <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>), e aquelas que manipulam grupos (como <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> e <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>). Nesse capítulo, nós focamos nas ferramentas que trabalham “no data frame como um todo”, mas você ainda não aprendeu muito sobre o que é possível fazer com uma variável individualmente. Nós voltaremos para essa assunto na parte do livro sobre Transformações, onde cada capítulo vai te mostrar ferramentas para cada tipo específico de variáveis.</p>
<p>No próximo capítulo, voltaremos ao fluxo de trabalho para discutir sobre a importância do estilo de código, mantendo seu código bem organizado facilitando que você e outros leiam e entendam.</p>


</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>de <em>double precision floating number</em> - remete à forma como números reais são representados nos computadores, utilizando 64 bits em vez dos tradicionais 32 bits de um inteiro comum, por isso “double” (dobro).<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Depos você irá aprender sobre a família de funções <code>slice_*()</code> que permite escolher linhas com base em suas posições.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>no hemisfério norte<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Lembre-se que no RStudio, o jeito mais fácil de visualizar um conjunto de dados com muitas colunas é <code><a href="https://rdrr.io/r/utils/View.html">View()</a></code>.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Ou <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code>, se você preferir o inglês britânico.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>*cof-cof* a lei dos grandes números *cof-cof*.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiada");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiada");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./workflow-basics.html" class="pagination-link  aria-label=" fluxo="" de="" trabalho:="" b="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">✅ Fluxo de Trabalho: básico</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./workflow-style.html" class="pagination-link" aria-label="<span class='chapter-number'>4</span>&nbsp; <span class='chapter-title'>✅ Fluxo de trabalho: estilo de código</span>">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">✅ Fluxo de trabalho: estilo de código</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>R para Ciência de Dados (2ª edição) foi escrito por Hadley Wickham, Mine Çetinkaya-Rundel, e Garrett Grolemund.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/cienciadedatos/pt-r4ds/edit/main/data-transform.qmd" class="toc-action"><i class="bi bi-github"></i>Editar essa página</a></li><li><a href="https://github.com/cienciadedatos/pt-r4ds/issues/new" class="toc-action"><i class="bi empty"></i>Criar uma issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Este livro foi contruído com <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>


</body></html>