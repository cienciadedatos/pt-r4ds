<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt" xml:lang="pt"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Hadley Wickham, Mine Çetinkaya-Rundel, e Garrett Grolemund">
<title>R para Ciência de Dados (2ª edição) - 12&nbsp; ✅ Vetores lógicos</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./numbers.html" rel="next">
<link href="./transform.html" rel="prev">
<link href="./cover.jpg" rel="icon" type="image/jpeg">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Nenhum resultado",
    "search-matching-documents-text": "documentos correspondentes",
    "search-copy-link-title": "Copiar link para a busca",
    "search-hide-matches-text": "Esconder correspondências adicionais",
    "search-more-match-text": "mais correspondência neste documento",
    "search-more-matches-text": "mais correspondências neste documento",
    "search-clear-button-title": "Limpar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Procurar"
  }
}</script><script defer="" data-domain="r4ds.hadley.nz" src="https://plausible.io/js/plausible.js"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./transform.html">✅ Transformar</a></li><li class="breadcrumb-item"><a href="./logicals.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">✅ Vetores lógicos</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">R para Ciência de Dados (2ª edição)</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/cienciadedatos/pt-r4ds/" title="Código fonte" class="quarto-navigation-tool px-1" aria-label="Código fonte"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Alternar modo de leitor">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Procurar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">✅ Boas-vindas</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface-2e.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">✅ Prefácio da segunda edição</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">✅ Introdução</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./whole-game.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">✅ Visão geral</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-visualize.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">✅ Visualização de dados</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">✅ Fluxo de Trabalho: básico</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-transform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">✅ Transformação de dados</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow-style.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">✅ Fluxo de trabalho: estilo de código</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-tidy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">✅ Organização de dados (<em>data tidying</em>)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow-scripts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">✅ Fluxo de trabalho: scripts e projetos</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-import.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">✅ Importação de dados</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow-help.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">✅ Fluxo de trabalho: obtendo ajuda</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./visualize.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">✅ Visualizar</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./layers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">✅ Camadas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./EDA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Exploratory data analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./communication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Communication</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./transform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">✅ Transformar</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./logicals.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">✅ Vetores lógicos</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./numbers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">✅ Números</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./strings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Strings</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./regexps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Regular expressions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./factors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">✅ Fatores</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datetimes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Dates and times</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missing-values.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">✅ Valores faltantes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./joins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Joins</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./import.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">✅ Importar</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spreadsheets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">✅ Planilhas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./databases.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">✅ Bancos de dados</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./arrow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">✅ Arrow</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rectangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Hierarchical data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./webscraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">✅ Raspagem de dados (<em>Web scraping</em>)</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./program.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">✅ Programar</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">✅ Funções</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./iteration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Iteration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./base-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">✅ Um guia para o R base</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./communicate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">✅ Comunicar</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">✅ Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quarto-formats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">✅ Formatos para Quarto</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Índice</h2>
   
  <ul>
<li>
<a href="#introdu%C3%A7%C3%A3o" id="toc-introdução" class="nav-link active" data-scroll-target="#introdu%C3%A7%C3%A3o"><span class="header-section-number">12.1</span> Introdução</a>
  <ul class="collapse">
<li><a href="#pr%C3%A9-requisitos" id="toc-pré-requisitos" class="nav-link" data-scroll-target="#pr%C3%A9-requisitos"><span class="header-section-number">12.1.1</span> Pré-requisitos</a></li>
  </ul>
</li>
  <li>
<a href="#compara%C3%A7%C3%B5es" id="toc-comparações" class="nav-link" data-scroll-target="#compara%C3%A7%C3%B5es"><span class="header-section-number">12.2</span> Comparações</a>
  <ul class="collapse">
<li><a href="#sec-fp-comparison" id="toc-sec-fp-comparison" class="nav-link" data-scroll-target="#sec-fp-comparison"><span class="header-section-number">12.2.1</span> Comparações com ponto-flutuante (<em>floating point</em>)</a></li>
  <li><a href="#sec-na-comparison" id="toc-sec-na-comparison" class="nav-link" data-scroll-target="#sec-na-comparison"><span class="header-section-number">12.2.2</span> Valores faltantes (<em>missing values</em>)</a></li>
  <li><a href="#is.na" id="toc-is.na" class="nav-link" data-scroll-target="#is.na"><span class="header-section-number">12.2.3</span> <code>is.na()</code></a></li>
  <li><a href="#exerc%C3%ADcio" id="toc-exercício" class="nav-link" data-scroll-target="#exerc%C3%ADcio"><span class="header-section-number">12.2.4</span> Exercício</a></li>
  </ul>
</li>
  <li>
<a href="#%C3%A1lgebra-booleana" id="toc-álgebra-booleana" class="nav-link" data-scroll-target="#%C3%A1lgebra-booleana"><span class="header-section-number">12.3</span> Álgebra booleana</a>
  <ul class="collapse">
<li><a href="#sec-na-boolean" id="toc-sec-na-boolean" class="nav-link" data-scroll-target="#sec-na-boolean"><span class="header-section-number">12.3.1</span> Valores faltantes (<em>missing values</em>)</a></li>
  <li><a href="#ordem-das-opera%C3%A7%C3%B5es" id="toc-ordem-das-operações" class="nav-link" data-scroll-target="#ordem-das-opera%C3%A7%C3%B5es"><span class="header-section-number">12.3.2</span> Ordem das operações</a></li>
  <li><a href="#in" id="toc-in" class="nav-link" data-scroll-target="#in"><span class="header-section-number">12.3.3</span> <code>%in%</code></a></li>
  <li><a href="#exerc%C3%ADcios" id="toc-exercícios" class="nav-link" data-scroll-target="#exerc%C3%ADcios"><span class="header-section-number">12.3.4</span> Exercícios</a></li>
  </ul>
</li>
  <li>
<a href="#sec-logical-summaries" id="toc-sec-logical-summaries" class="nav-link" data-scroll-target="#sec-logical-summaries"><span class="header-section-number">12.4</span> Sumarização</a>
  <ul class="collapse">
<li><a href="#sumariza%C3%A7%C3%B5es-l%C3%B3gicas" id="toc-sumarizações-lógicas" class="nav-link" data-scroll-target="#sumariza%C3%A7%C3%B5es-l%C3%B3gicas"><span class="header-section-number">12.4.1</span> Sumarizações lógicas</a></li>
  <li><a href="#sec-numeric-summaries-of-logicals" id="toc-sec-numeric-summaries-of-logicals" class="nav-link" data-scroll-target="#sec-numeric-summaries-of-logicals"><span class="header-section-number">12.4.2</span> Sumarizações numéricas de vetores lógicos</a></li>
  <li><a href="#subconjunto-subsetting-l%C3%B3gico" id="toc-subconjunto-subsetting-lógico" class="nav-link" data-scroll-target="#subconjunto-subsetting-l%C3%B3gico"><span class="header-section-number">12.4.3</span> Subconjunto (<em>subsetting</em>) lógico</a></li>
  <li><a href="#exerc%C3%ADcios-1" id="toc-exercícios-1" class="nav-link" data-scroll-target="#exerc%C3%ADcios-1"><span class="header-section-number">12.4.4</span> Exercícios</a></li>
  </ul>
</li>
  <li>
<a href="#transforma%C3%A7%C3%B5es-condicionais" id="toc-transformações-condicionais" class="nav-link" data-scroll-target="#transforma%C3%A7%C3%B5es-condicionais"><span class="header-section-number">12.5</span> Transformações condicionais</a>
  <ul class="collapse">
<li><a href="#if_else" id="toc-if_else" class="nav-link" data-scroll-target="#if_else"><span class="header-section-number">12.5.1</span> <code>if_else()</code></a></li>
  <li><a href="#case_when" id="toc-case_when" class="nav-link" data-scroll-target="#case_when"><span class="header-section-number">12.5.2</span> <code>case_when()</code></a></li>
  <li><a href="#tipos-compat%C3%ADveis" id="toc-tipos-compatíveis" class="nav-link" data-scroll-target="#tipos-compat%C3%ADveis"><span class="header-section-number">12.5.3</span> Tipos compatíveis</a></li>
  <li><a href="#exerc%C3%ADcios-2" id="toc-exercícios-2" class="nav-link" data-scroll-target="#exerc%C3%ADcios-2"><span class="header-section-number">12.5.4</span> Exercícios</a></li>
  </ul>
</li>
  <li><a href="#resumo" id="toc-resumo" class="nav-link" data-scroll-target="#resumo"><span class="header-section-number">12.6</span> Resumo</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/cienciadedatos/pt-r4ds/edit/main/logicals.qmd" class="toc-action"><i class="bi bi-github"></i>Editar essa página</a></li><li><a href="https://github.com/cienciadedatos/pt-r4ds/issues/new" class="toc-action"><i class="bi empty"></i>Criar uma issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./transform.html">✅ Transformar</a></li><li class="breadcrumb-item"><a href="./logicals.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">✅ Vetores lógicos</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-logicals" class="quarto-section-identifier"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">✅ Vetores lógicos</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="introdução" class="level2" data-number="12.1"><h2 data-number="12.1" class="anchored" data-anchor-id="introdução">
<span class="header-section-number">12.1</span> Introdução</h2>
<p>Neste capítulo, você aprenderá ferramentas para trabalhar com vetores lógicos. Vetores lógicos são a forma mais simples de vetores, pois cada elemento pode ter apenas um dos três possíveis valores: <code>TRUE</code>, <code>FALSE</code> e <code>NA</code>. É relativamente raro encontrar vetores lógicos em seus dados brutos, mas você os criará e manipulará no decorrer de quase todas as análises.</p>
<p>Começaremos discutindo a forma mais comum de criar vetores lógicos: por meio de comparações numéricas. Em seguida, você aprenderá como usar a álgebra booleana para combinar diferentes vetores lógicos, bem como algumas sumarizações úteis. Terminaremos com <code><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else()</a></code> e <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code>, duas funções úteis para fazer alterações condicionais alimentadas por vetores lógicos.</p>
<section id="pré-requisitos" class="level3" data-number="12.1.1"><h3 data-number="12.1.1" class="anchored" data-anchor-id="pré-requisitos">
<span class="header-section-number">12.1.1</span> Pré-requisitos</h3>
<p>A maioria das funções que você aprenderá neste capítulo são fornecidas pelo R base, então não precisamos do tidyverse, mas ainda assim iremos carregá-lo para que possamos usar <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>, e demais funções para trabalhar com <em>data frames</em>. Também continuaremos a extrair exemplos do conjunto de dados <code><a href="https://rdrr.io/pkg/dados/man/voos.html">dados::voos</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/cienciadedatos/dados">dados</a></span><span class="op">)</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>No entanto, à medida que começamos a estudar novas ferramentas, nem sempre haverá um exemplo real perfeito. Então, começaremos a criar alguns dados fictícios com <code><a href="https://rdrr.io/r/base/c.html">c()</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">7</span>, <span class="fl">11</span>, <span class="fl">13</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">*</span> <span class="fl">2</span></span>
<span><span class="co">#&gt; [1]  2  4  6 10 14 22 26</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Isso facilita a explicação de funções individuais, ao custo de dificultar a visualização de como elas podem se aplicar aos seus problemas de dados. Apenas lembre-se de que qualquer transformação que fizermos em um vetor simples, você poderá fazer em uma variável dentro de <em>data frame</em> com <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> e demais funções amigas.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">x</span> <span class="op">*</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 7 × 2</span></span>
<span><span class="co">#&gt;       x     y</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1     2</span></span>
<span><span class="co">#&gt; 2     2     4</span></span>
<span><span class="co">#&gt; 3     3     6</span></span>
<span><span class="co">#&gt; 4     5    10</span></span>
<span><span class="co">#&gt; 5     7    14</span></span>
<span><span class="co">#&gt; 6    11    22</span></span>
<span><span class="co">#&gt; # ℹ 1 more row</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="comparações" class="level2" data-number="12.2"><h2 data-number="12.2" class="anchored" data-anchor-id="comparações">
<span class="header-section-number">12.2</span> Comparações</h2>
<p>Uma forma muito comum de criar um vetor lógico é através de uma comparação numérica usando <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>!=</code> e <code>==</code>. Até agora, criamos principalmente variáveis ​​lógicas temporariamente dentro do <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> — elas são calculadas, usadas e depois jogadas fora. Por exemplo, o filtro abaixo encontra todo os voos que sairam durante o dia e chegaram aproximadamente no horário:</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">horario_saida</span> <span class="op">&gt;</span> <span class="fl">600</span> <span class="op">&amp;</span> <span class="va">horario_saida</span> <span class="op">&lt;</span> <span class="fl">2000</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">atraso_chegada</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 172,286 × 19</span></span>
<span><span class="co">#&gt;     ano   mes   dia horario_saida saida_programada atraso_saida</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;         &lt;int&gt;            &lt;int&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  2013     1     1           601              600            1</span></span>
<span><span class="co">#&gt; 2  2013     1     1           602              610           -8</span></span>
<span><span class="co">#&gt; 3  2013     1     1           602              605           -3</span></span>
<span><span class="co">#&gt; 4  2013     1     1           606              610           -4</span></span>
<span><span class="co">#&gt; 5  2013     1     1           606              610           -4</span></span>
<span><span class="co">#&gt; 6  2013     1     1           607              607            0</span></span>
<span><span class="co">#&gt; # ℹ 172,280 more rows</span></span>
<span><span class="co">#&gt; # ℹ 13 more variables: horario_chegada &lt;int&gt;, chegada_prevista &lt;int&gt;, …</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>É útil saber que isto é apenas um atalho e você pode explicitamente criar a variável lógica intrínseca com <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    diurno <span class="op">=</span> <span class="va">horario_saida</span> <span class="op">&gt;</span> <span class="fl">600</span> <span class="op">&amp;</span> <span class="va">horario_saida</span> <span class="op">&lt;</span> <span class="fl">2000</span>,</span>
<span>    aprox_no_horario <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">atraso_chegada</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">20</span>,</span>
<span>    .keep <span class="op">=</span> <span class="st">"used"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 336,776 × 4</span></span>
<span><span class="co">#&gt;   horario_saida atraso_chegada diurno aprox_no_horario</span></span>
<span><span class="co">#&gt;           &lt;int&gt;          &lt;dbl&gt; &lt;lgl&gt;  &lt;lgl&gt;           </span></span>
<span><span class="co">#&gt; 1           517             11 FALSE  TRUE            </span></span>
<span><span class="co">#&gt; 2           533             20 FALSE  FALSE           </span></span>
<span><span class="co">#&gt; 3           542             33 FALSE  FALSE           </span></span>
<span><span class="co">#&gt; 4           544            -18 FALSE  TRUE            </span></span>
<span><span class="co">#&gt; 5           554            -25 FALSE  FALSE           </span></span>
<span><span class="co">#&gt; 6           554             12 FALSE  TRUE            </span></span>
<span><span class="co">#&gt; # ℹ 336,770 more rows</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Isto é particularmente útil para lógicas mais complicadas, pois nomeando os passos intermediários, se torna mais fácil tanto ler o código quanto verificar se cada passo está sendo calculado corretamente.</p>
<p>Com isto, o filtro inicial é equivalente a:</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    diurno <span class="op">=</span> <span class="va">horario_saida</span> <span class="op">&gt;</span> <span class="fl">600</span> <span class="op">&amp;</span> <span class="va">horario_saida</span> <span class="op">&lt;</span> <span class="fl">2000</span>,</span>
<span>    aprox_no_horario <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">atraso_chegada</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">20</span>,</span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">diurno</span> <span class="op">&amp;</span> <span class="va">aprox_no_horario</span><span class="op">)</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="sec-fp-comparison" class="level3" data-number="12.2.1"><h3 data-number="12.2.1" class="anchored" data-anchor-id="sec-fp-comparison">
<span class="header-section-number">12.2.1</span> Comparações com ponto-flutuante (<em>floating point</em>)</h3>
<p>Cuidado ao usar <code>==</code> com números. Por exemplo, parece que este vetor contém os números 1 e 2:</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fl">49</span> <span class="op">*</span> <span class="fl">49</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt; [1] 1 2</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Mas se você fizer um teste de igualdade, você terá <code>FALSE</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE FALSE</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>O que está acontecendo aqui? Os computadores armazenam números com um número fixo de casas decimais, então não há como representar exatamente 1/49 ou <code>sqrt(2)</code> e os cálculos subsequentes serão ligeiramente imprecisos. Podemos ver os valores exatos chamando <code><a href="https://rdrr.io/r/base/print.html">print()</a></code> com o argumento <code>digits</code><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>:</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">x</span>, digits <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.9999999999999999 2.0000000000000004</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Você pode ver porque o R arrendonda estes números por padrão: eles são realmente muito próximos ao que você espera.</p>
<p>Agora que você viu porque <code>==</code> falhou, o que você pode fazer a respeito? Uma opção é usar <code><a href="https://dplyr.tidyverse.org/reference/near.html">dplyr::near()</a></code> que ignora pequenas diferenças:</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/near.html">near</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE TRUE</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="sec-na-comparison" class="level3" data-number="12.2.2"><h3 data-number="12.2.2" class="anchored" data-anchor-id="sec-na-comparison">
<span class="header-section-number">12.2.2</span> Valores faltantes (<em>missing values</em>)</h3>
<p>Os valores faltantes (<em>missing values</em>) representam o desconhecido, portanto são “contagiosos”: quase qualquer operação que envolva um valor desconhecido também será desconhecida:</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="cn">NA</span> <span class="op">&gt;</span> <span class="fl">5</span></span>
<span><span class="co">#&gt; [1] NA</span></span>
<span><span class="fl">10</span> <span class="op">==</span> <span class="cn">NA</span></span>
<span><span class="co">#&gt; [1] NA</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>O resultado mais confuso é este:</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="cn">NA</span> <span class="op">==</span> <span class="cn">NA</span></span>
<span><span class="co">#&gt; [1] NA</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>É mais fácil entender porque isto é verdadeiro se nós artificialmente fornecermos um pouco mais de contexto:</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Não sabemos a idade de Maria</span></span>
<span><span class="va">idade_maria</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="co"># Não sabemos a idade de João</span></span>
<span><span class="va">idade_joao</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="co"># João e Maria tem a mesma idade?</span></span>
<span><span class="va">idade_maria</span> <span class="op">==</span> <span class="va">idade_joao</span></span>
<span><span class="co">#&gt; [1] NA</span></span>
<span><span class="co"># Não sabemos!</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Portanto, se você quiser encontrar todos os voos onde <code>horario_saida</code> está faltando, o código a seguir não funciona, pois <code>horario_saida == NA</code> retorna <code>NA</code> para cada linha e <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> ignora automaticamente valores faltantes:</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">horario_saida</span> <span class="op">==</span> <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 0 × 19</span></span>
<span><span class="co">#&gt; # ℹ 19 variables: ano &lt;int&gt;, mes &lt;int&gt;, dia &lt;int&gt;, horario_saida &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   saida_programada &lt;int&gt;, atraso_saida &lt;dbl&gt;, horario_chegada &lt;int&gt;, …</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ao invés disso, vocè precisará de uma nova ferramenta: <code><a href="https://rdrr.io/r/base/NA.html">is.na()</a></code>.</p>
</section><section id="is.na" class="level3" data-number="12.2.3"><h3 data-number="12.2.3" class="anchored" data-anchor-id="is.na">
<span class="header-section-number">12.2.3</span> <code>is.na()</code>
</h3>
<p><code>is.na(x)</code> funciona com qualquer tipo de vetor e retorna <code>TRUE</code> para valores faltantes e <code>FALSE</code> para qualquer outra coisa:</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">NA</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE  TRUE FALSE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="cn">NA</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE  TRUE FALSE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="cn">NA</span>, <span class="st">"b"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE  TRUE FALSE</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Podemos usar <code><a href="https://rdrr.io/r/base/NA.html">is.na()</a></code> para encontrar todos os registros com <code>horario_saida</code> faltando:</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">horario_saida</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 8,255 × 19</span></span>
<span><span class="co">#&gt;     ano   mes   dia horario_saida saida_programada atraso_saida</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;         &lt;int&gt;            &lt;int&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  2013     1     1            NA             1630           NA</span></span>
<span><span class="co">#&gt; 2  2013     1     1            NA             1935           NA</span></span>
<span><span class="co">#&gt; 3  2013     1     1            NA             1500           NA</span></span>
<span><span class="co">#&gt; 4  2013     1     1            NA              600           NA</span></span>
<span><span class="co">#&gt; 5  2013     1     2            NA             1540           NA</span></span>
<span><span class="co">#&gt; 6  2013     1     2            NA             1620           NA</span></span>
<span><span class="co">#&gt; # ℹ 8,249 more rows</span></span>
<span><span class="co">#&gt; # ℹ 13 more variables: horario_chegada &lt;int&gt;, chegada_prevista &lt;int&gt;, …</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code><a href="https://rdrr.io/r/base/NA.html">is.na()</a></code> também pode ser útil em <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code>. <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> geralmente coloca todos os valores faltantes no final, mas você pode sobreescrever este padrão ordenando primeiro com <code><a href="https://rdrr.io/r/base/NA.html">is.na()</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">mes</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">dia</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">horario_saida</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 842 × 19</span></span>
<span><span class="co">#&gt;     ano   mes   dia horario_saida saida_programada atraso_saida</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;         &lt;int&gt;            &lt;int&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  2013     1     1           517              515            2</span></span>
<span><span class="co">#&gt; 2  2013     1     1           533              529            4</span></span>
<span><span class="co">#&gt; 3  2013     1     1           542              540            2</span></span>
<span><span class="co">#&gt; 4  2013     1     1           544              545           -1</span></span>
<span><span class="co">#&gt; 5  2013     1     1           554              600           -6</span></span>
<span><span class="co">#&gt; 6  2013     1     1           554              558           -4</span></span>
<span><span class="co">#&gt; # ℹ 836 more rows</span></span>
<span><span class="co">#&gt; # ℹ 13 more variables: horario_chegada &lt;int&gt;, chegada_prevista &lt;int&gt;, …</span></span>
<span></span>
<span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">mes</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">dia</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">horario_saida</span><span class="op">)</span><span class="op">)</span>, <span class="va">horario_saida</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 842 × 19</span></span>
<span><span class="co">#&gt;     ano   mes   dia horario_saida saida_programada atraso_saida</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;         &lt;int&gt;            &lt;int&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  2013     1     1            NA             1630           NA</span></span>
<span><span class="co">#&gt; 2  2013     1     1            NA             1935           NA</span></span>
<span><span class="co">#&gt; 3  2013     1     1            NA             1500           NA</span></span>
<span><span class="co">#&gt; 4  2013     1     1            NA              600           NA</span></span>
<span><span class="co">#&gt; 5  2013     1     1           517              515            2</span></span>
<span><span class="co">#&gt; 6  2013     1     1           533              529            4</span></span>
<span><span class="co">#&gt; # ℹ 836 more rows</span></span>
<span><span class="co">#&gt; # ℹ 13 more variables: horario_chegada &lt;int&gt;, chegada_prevista &lt;int&gt;, …</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Voltaremos a abordar mais detalhes sobre valores faltantes (<em>missing values</em>) no <a href="missing-values.html" class="quarto-xref"><span>Capítulo 18</span></a>.</p>
</section><section id="exercício" class="level3" data-number="12.2.4"><h3 data-number="12.2.4" class="anchored" data-anchor-id="exercício">
<span class="header-section-number">12.2.4</span> Exercício</h3>
<ol type="1">
<li>Como <code><a href="https://dplyr.tidyverse.org/reference/near.html">dplyr::near()</a></code> funciona? Digite <code>near</code> para ver o código fonte. <code>sqrt(2)^2</code> é próximo (near) a 2?</li>
<li>Use <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, <code><a href="https://rdrr.io/r/base/NA.html">is.na()</a></code> e <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code> juntos para descrever como os valores faltantes (<em>missing values</em>) em <code>horario_saida</code>, <code>saida_programada</code> e <code>atraso_saida</code> estão relacionados.</li>
</ol></section></section><section id="álgebra-booleana" class="level2" data-number="12.3"><h2 data-number="12.3" class="anchored" data-anchor-id="álgebra-booleana">
<span class="header-section-number">12.3</span> Álgebra booleana</h2>
<p>Quando você tem múltiplos vetores lógicos, você pode combiná-los usando álgebra booleana. No R, <code>&amp;</code> é “e”, <code>|</code> é “ou”, <code>!</code> é “não” e <code><a href="https://rdrr.io/r/base/Logic.html">xor()</a></code> é ou exclusivo<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. Por exemplo, <code>df |&gt; filter(!is.na(x))</code> encontra todas as linhas onde <code>x</code> está faltando e <code>df |&gt; filter(x &lt; -10 | x &gt; 0)</code> encontra todas as linhas onde <code>x</code> é menor que -10 ou maior que 0. A <a href="#fig-bool-ops" class="quarto-xref">Figura&nbsp;<span>12.1</span></a> mostra o conjunto completo de operações booleanas e como elas funcionam.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-bool-ops" class="quarto-figure quarto-figure-center quarto-float anchored" alt="Seis diagramas de Venn, cada um explicando um determinado operador lógico. Os círculos (conjuntos) em cada diagrama de Venn representam x e y. 1. y &amp; !x é y mas nada de x; x &amp; y é a intersecção de de x e y; x &amp; !y é x mas nada de y; x é tudo de x mas nada de y; xor(x, y) é tudo menos a interseccção de x e y; y é tudo de y e nada de x; e x | y é tudo.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-bool-ops-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="diagrams/transform.png" class="img-fluid figure-img" alt="Seis diagramas de Venn, cada um explicando um determinado operador lógico. Os círculos (conjuntos) em cada diagrama de Venn representam x e y. 1. y &amp; !x é y mas nada de x; x &amp; y é a intersecção de de x e y; x &amp; !y é x mas nada de y; x é tudo de x mas nada de y; xor(x, y) é tudo menos a interseccção de x e y; y é tudo de y e nada de x; e x | y é tudo." width="395">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-bool-ops-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;12.1: O conjunto completo de operações booleanas. <code>x</code> é o círculo da esquerda , <code>y</code> é o círculo da direita e a região preenchida mostra qual parte cada operação seleciona.
</figcaption></figure>
</div>
</div>
</div>
<p>Além de <code>&amp;</code> e <code>|</code>, o R também possui <code>&amp;&amp;</code> e <code>||</code>. Não os use em funções dplyr! Eles são chamados de operadores de curto-circuito e retornam sempre apenas um único <code>TRUE</code> ou <code>FALSE</code>. Eles são importantes na programação, não em ciência de dados.</p>
<section id="sec-na-boolean" class="level3" data-number="12.3.1"><h3 data-number="12.3.1" class="anchored" data-anchor-id="sec-na-boolean">
<span class="header-section-number">12.3.1</span> Valores faltantes (<em>missing values</em>)</h3>
<p>As regras para valores faltantes na álgebra booleana são um pouco complicadas de explicar porque parecem inconsistentes à primeira vista:</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    e <span class="op">=</span> <span class="va">x</span> <span class="op">&amp;</span> <span class="cn">NA</span>,</span>
<span>    ou <span class="op">=</span> <span class="va">x</span> <span class="op">|</span> <span class="cn">NA</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 3</span></span>
<span><span class="co">#&gt;   x     e     ou   </span></span>
<span><span class="co">#&gt;   &lt;lgl&gt; &lt;lgl&gt; &lt;lgl&gt;</span></span>
<span><span class="co">#&gt; 1 TRUE  NA    TRUE </span></span>
<span><span class="co">#&gt; 2 FALSE FALSE NA   </span></span>
<span><span class="co">#&gt; 3 NA    NA    NA</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para entender o que está acontecendo aqui, pense em <code>NA | TRUE</code> (<code>NA</code> ou <code>TRUE</code>). Um valor faltante (<em>missing value</em>) em um vetor lógico significa que o valor poderia ser <code>TRUE</code> ou <code>FALSE</code>. <code>TRUE | TRUE</code> e <code>FALSE | TRUE</code> são ambos <code>TRUE</code> pois ao menos um dos termos é <code>TRUE</code>. <code>NA | TRUE</code> também deve ser <code>TRUE</code> pois <code>NA</code> pode ser <code>TRUE</code> ou <code>FALSE</code>. Entretanto, <code>NA | FALSE</code> é <code>NA</code> pois não sabemos se <code>NA</code> é <code>TRUE</code> ou <code>FALSE</code>. O mesmo se aplica com <code>NA &amp; FALSE</code>.</p>
</section><section id="ordem-das-operações" class="level3" data-number="12.3.2"><h3 data-number="12.3.2" class="anchored" data-anchor-id="ordem-das-operações">
<span class="header-section-number">12.3.2</span> Ordem das operações</h3>
<p>Observe que a ordem das operações não funcionam como em Português. Veja o seguinte código que encontra todos os voos que saíram em novembro ou dezembro:</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">mes</span> <span class="op">==</span> <span class="fl">11</span> <span class="op">|</span> <span class="va">mes</span> <span class="op">==</span> <span class="fl">12</span><span class="op">)</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Você pode estar tentado a escrevê-lo da forma que falaria em Português: “Encontre todos os voos que saíram em Novemebro e Dezembro.”:</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">mes</span> <span class="op">==</span> <span class="fl">11</span> <span class="op">|</span> <span class="fl">12</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 336,776 × 19</span></span>
<span><span class="co">#&gt;     ano   mes   dia horario_saida saida_programada atraso_saida</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;         &lt;int&gt;            &lt;int&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  2013     1     1           517              515            2</span></span>
<span><span class="co">#&gt; 2  2013     1     1           533              529            4</span></span>
<span><span class="co">#&gt; 3  2013     1     1           542              540            2</span></span>
<span><span class="co">#&gt; 4  2013     1     1           544              545           -1</span></span>
<span><span class="co">#&gt; 5  2013     1     1           554              600           -6</span></span>
<span><span class="co">#&gt; 6  2013     1     1           554              558           -4</span></span>
<span><span class="co">#&gt; # ℹ 336,770 more rows</span></span>
<span><span class="co">#&gt; # ℹ 13 more variables: horario_chegada &lt;int&gt;, chegada_prevista &lt;int&gt;, …</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Este código não gera erro, mas também não parece ter funcionado. O que acontece aqui? Neste caso, o R calcula <code>mes == 11</code> criando um vetor lógico, o qual chamaremos de <code>nov</code>. Então calcula <code>nov | 12</code>. Quando usamos um número com um operador lógico, ele converte tudo exceto 0 para <code>TRUE</code>, o que é equivalente a <code>nov | TRUE</code> o que é sempre <code>TRUE</code>, então cada linha será selecionada:</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    nov <span class="op">=</span> <span class="va">mes</span> <span class="op">==</span> <span class="fl">11</span>,</span>
<span>    final <span class="op">=</span> <span class="va">nov</span> <span class="op">|</span> <span class="fl">12</span>,</span>
<span>    .keep <span class="op">=</span> <span class="st">"used"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 336,776 × 3</span></span>
<span><span class="co">#&gt;     mes nov   final</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;lgl&gt; &lt;lgl&gt;</span></span>
<span><span class="co">#&gt; 1     1 FALSE TRUE </span></span>
<span><span class="co">#&gt; 2     1 FALSE TRUE </span></span>
<span><span class="co">#&gt; 3     1 FALSE TRUE </span></span>
<span><span class="co">#&gt; 4     1 FALSE TRUE </span></span>
<span><span class="co">#&gt; 5     1 FALSE TRUE </span></span>
<span><span class="co">#&gt; 6     1 FALSE TRUE </span></span>
<span><span class="co">#&gt; # ℹ 336,770 more rows</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="in" class="level3" data-number="12.3.3"><h3 data-number="12.3.3" class="anchored" data-anchor-id="in">
<span class="header-section-number">12.3.3</span> <code>%in%</code>
</h3>
<p>Um jeito fácil de evitar o problema de colocar <code>==</code>s e <code>|</code>s na ordem correta é usar <code>%in%</code>. <code>x %in% y</code> retorna um vetor lógico de mesmo tamanho que <code>x</code> que é <code>TRUE</code> sempre que um valor em <code>x</code> está em qualquer lugar em <code>y</code> .</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">11</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1]  TRUE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE</span></span>
<span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"e"</span>, <span class="st">"i"</span>, <span class="st">"o"</span>, <span class="st">"u"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1]  TRUE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE  TRUE FALSE</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Portanto, para encontrar todos os voos de novembro e dezembro, poderíamos escrever:</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">mes</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">11</span>, <span class="fl">12</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note que <code>%in%</code> possui diferentes regras do <code>NA</code> para <code>==</code>, uma vez que <code>NA %in% NA</code> é <code>TRUE</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="cn">NA</span><span class="op">)</span> <span class="op">==</span> <span class="cn">NA</span></span>
<span><span class="co">#&gt; [1] NA NA NA</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="cn">NA</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="cn">NA</span></span>
<span><span class="co">#&gt; [1] FALSE FALSE  TRUE</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Isto pode ser um atalho útil:</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">horario_saida</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">0800</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 8,803 × 19</span></span>
<span><span class="co">#&gt;     ano   mes   dia horario_saida saida_programada atraso_saida</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;         &lt;int&gt;            &lt;int&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  2013     1     1           800              800            0</span></span>
<span><span class="co">#&gt; 2  2013     1     1           800              810          -10</span></span>
<span><span class="co">#&gt; 3  2013     1     1            NA             1630           NA</span></span>
<span><span class="co">#&gt; 4  2013     1     1            NA             1935           NA</span></span>
<span><span class="co">#&gt; 5  2013     1     1            NA             1500           NA</span></span>
<span><span class="co">#&gt; 6  2013     1     1            NA              600           NA</span></span>
<span><span class="co">#&gt; # ℹ 8,797 more rows</span></span>
<span><span class="co">#&gt; # ℹ 13 more variables: horario_chegada &lt;int&gt;, chegada_prevista &lt;int&gt;, …</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="exercícios" class="level3" data-number="12.3.4"><h3 data-number="12.3.4" class="anchored" data-anchor-id="exercícios">
<span class="header-section-number">12.3.4</span> Exercícios</h3>
<ol type="1">
<li>Encontre todos os voos em que <code>atraso_chegada</code> está faltando (<em>missing</em>), mas <code>atraso_saida</code> não. Encontre todos os voos em que nem <code>horario_chegada</code> ou <code>chegada_prevista</code> estão faltando, mas <code>atraso_chegada</code> está.</li>
<li>Quantos voos possuem <code>horario_saida</code> faltando? Quais outras variáveis possuem valores faltantes nestes registros? O que podem representar estas linhas?</li>
<li>Assumindo que um valor faltante em <code>horario_saida</code> implica em um voo cancelado, olhe o número de voos cancelados por dia. Há algum padrão? Há alguma relação entre a proporção de voos cancelados e a média de atraso dos voos não cancelados?</li>
</ol></section></section><section id="sec-logical-summaries" class="level2" data-number="12.4"><h2 data-number="12.4" class="anchored" data-anchor-id="sec-logical-summaries">
<span class="header-section-number">12.4</span> Sumarização</h2>
<p>As seções a seguir descrevem técnicas úteis para sumarização de vetores lógicos. Assim como funções que trabalham especificamente com vetores lógicos, você também pode usar funções que trabalham com vetores numéricos.</p>
<section id="sumarizações-lógicas" class="level3" data-number="12.4.1"><h3 data-number="12.4.1" class="anchored" data-anchor-id="sumarizações-lógicas">
<span class="header-section-number">12.4.1</span> Sumarizações lógicas</h3>
<p>Existem dois sumarizadores lógicos: <code><a href="https://rdrr.io/r/base/any.html">any()</a></code> e <code><a href="https://rdrr.io/r/base/all.html">all()</a></code>. <code>any(x)</code> é o equivalente ao <code>|</code>; retornará <code>TRUE</code> se houver algum <code>TRUE</code> em <code>x</code>. <code>all(x)</code> é o equivalente ao <code>&amp;</code>; retornará <code>TRUE</code> somente se todos os valores de <code>x</code> forem <code>TRUE</code>. Assim como todas as funções de sumarização, elas retornarão <code>NA</code> se houver qualquer valor faltante (<em>missing value</em>) presente, e como de costume, você pode não considerá-los usando <code>na.rm = TRUE</code>.</p>
<p>Por exemplo, poderíamos usar <code><a href="https://rdrr.io/r/base/all.html">all()</a></code> e <code><a href="https://rdrr.io/r/base/any.html">any()</a></code> para descobrir se todos os voos foram atrasados na partida por no máximo uma hora ou se algum voo atrasou na chegada por cinco horas ou mais. E usando <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> podemos fazer isso para cada dia:</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ano</span>, <span class="va">mes</span>, <span class="va">dia</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    todos_atrasados <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="va">atraso_saida</span> <span class="op">&lt;=</span> <span class="fl">60</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    algum_atraso_longo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">atraso_chegada</span> <span class="op">&gt;=</span> <span class="fl">300</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 365 × 5</span></span>
<span><span class="co">#&gt;     ano   mes   dia todos_atrasados algum_atraso_longo</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;lgl&gt;           &lt;lgl&gt;             </span></span>
<span><span class="co">#&gt; 1  2013     1     1 FALSE           TRUE              </span></span>
<span><span class="co">#&gt; 2  2013     1     2 FALSE           TRUE              </span></span>
<span><span class="co">#&gt; 3  2013     1     3 FALSE           FALSE             </span></span>
<span><span class="co">#&gt; 4  2013     1     4 FALSE           FALSE             </span></span>
<span><span class="co">#&gt; 5  2013     1     5 FALSE           TRUE              </span></span>
<span><span class="co">#&gt; 6  2013     1     6 FALSE           FALSE             </span></span>
<span><span class="co">#&gt; # ℹ 359 more rows</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Na maioria dos casos, entretanto, <code><a href="https://rdrr.io/r/base/any.html">any()</a></code> e <code><a href="https://rdrr.io/r/base/all.html">all()</a></code> são um tanto grosseiros, e seria bom poder obter mais detalhes sobre os valores <code>TRUE</code> ou <code>FALSE</code>. Isso nos leva aos sumarizadores numéricos.</p>
</section><section id="sec-numeric-summaries-of-logicals" class="level3" data-number="12.4.2"><h3 data-number="12.4.2" class="anchored" data-anchor-id="sec-numeric-summaries-of-logicals">
<span class="header-section-number">12.4.2</span> Sumarizações numéricas de vetores lógicos</h3>
<p>Quando você usa um vetor lógico em um contexto numérico, <code>TRUE</code> se torna 1 e <code>FALSE</code> se torna 0. Isto torna <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> e <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> muito úteis com vetores lógicos, pois <code>sum(x)</code> retorna o número de <code>TRUE</code>s e <code>mean(x)</code> retorna a proporção de <code>TRUE</code>s (pois <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> é <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> dividido por <code><a href="https://rdrr.io/r/base/length.html">length()</a></code>).</p>
<p>Isto, por exemplo, nos permite ver a proporção de voos que tiveram atraso na saída em até uma hora e o número de voos que chegaram atrasados em cinco horas ou mais:</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ano</span>, <span class="va">mes</span>, <span class="va">dia</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    todos_atrasados <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">atraso_saida</span> <span class="op">&lt;=</span> <span class="fl">60</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    algum_atraso_longo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">atraso_chegada</span> <span class="op">&gt;=</span> <span class="fl">300</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 365 × 5</span></span>
<span><span class="co">#&gt;     ano   mes   dia todos_atrasados algum_atraso_longo</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;           &lt;dbl&gt;              &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1  2013     1     1           0.939                  3</span></span>
<span><span class="co">#&gt; 2  2013     1     2           0.914                  3</span></span>
<span><span class="co">#&gt; 3  2013     1     3           0.941                  0</span></span>
<span><span class="co">#&gt; 4  2013     1     4           0.953                  0</span></span>
<span><span class="co">#&gt; 5  2013     1     5           0.964                  1</span></span>
<span><span class="co">#&gt; 6  2013     1     6           0.959                  0</span></span>
<span><span class="co">#&gt; # ℹ 359 more rows</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="subconjunto-subsetting-lógico" class="level3" data-number="12.4.3"><h3 data-number="12.4.3" class="anchored" data-anchor-id="subconjunto-subsetting-lógico">
<span class="header-section-number">12.4.3</span> Subconjunto (<em>subsetting</em>) lógico</h3>
<p>Existe ainda um último uso de vetores lógicos em sumarizações: você pode usar um vetor lógico para filtrar uma única variável em um subconjunto (<em>subset</em>) de interesse. Isto faz uso do operador do R base <code>[</code> (se pronuncia <em>subset</em>), o qual você aprenderá mais na <a href="base-R.html#sec-subset-many" class="quarto-xref"><span>Seção 27.2</span></a>.</p>
<p>Imagine que gostaríamos de encontrar a média de atraso somente de voos que realmente estiveram atrasados. Uma forma de fazê-lo seria primeiro filtrar os voos e depois calcular a média de atraso:</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">atraso_chegada</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ano</span>, <span class="va">mes</span>, <span class="va">dia</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    atraso_medio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">atraso_chegada</span><span class="op">)</span>,</span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 365 × 5</span></span>
<span><span class="co">#&gt;     ano   mes   dia atraso_medio     n</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;        &lt;dbl&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1  2013     1     1         32.5   461</span></span>
<span><span class="co">#&gt; 2  2013     1     2         32.0   535</span></span>
<span><span class="co">#&gt; 3  2013     1     3         27.7   460</span></span>
<span><span class="co">#&gt; 4  2013     1     4         28.3   297</span></span>
<span><span class="co">#&gt; 5  2013     1     5         22.6   238</span></span>
<span><span class="co">#&gt; 6  2013     1     6         24.4   381</span></span>
<span><span class="co">#&gt; # ℹ 359 more rows</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Isto funciona, mas e se você quisesse calcular o atraso médio também para voos que chegaram antecipadamente? Precisaríamos fazer um passo extra de filtro e então combinar os dois <em>data frames</em><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. Ao invés disso, você poderia usar <code>[</code> para executar um filtro em linha (<em>inline</em>): <code>atraso_chegada[atraso_chegada &gt; 0]</code> irá retornar apenas os atrasos positivos na chegada.</p>
<p>Isso leva a:</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ano</span>, <span class="va">mes</span>, <span class="va">dia</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    atrasado <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">atraso_chegada</span><span class="op">[</span><span class="va">atraso_chegada</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    antecipado <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">atraso_chegada</span><span class="op">[</span><span class="va">atraso_chegada</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 365 × 6</span></span>
<span><span class="co">#&gt;     ano   mes   dia atrasado antecipado     n</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;dbl&gt;      &lt;dbl&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1  2013     1     1     32.5      -12.5   842</span></span>
<span><span class="co">#&gt; 2  2013     1     2     32.0      -14.3   943</span></span>
<span><span class="co">#&gt; 3  2013     1     3     27.7      -18.2   914</span></span>
<span><span class="co">#&gt; 4  2013     1     4     28.3      -17.0   915</span></span>
<span><span class="co">#&gt; 5  2013     1     5     22.6      -14.0   720</span></span>
<span><span class="co">#&gt; 6  2013     1     6     24.4      -13.6   832</span></span>
<span><span class="co">#&gt; # ℹ 359 more rows</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Observe também a diferença no tamanho do grupo: no primeiro segmento <code><a href="https://dplyr.tidyverse.org/reference/context.html">n()</a></code> tem o número de voos em atraso por dia, no segundo, <code><a href="https://dplyr.tidyverse.org/reference/context.html">n()</a></code> retorna o número total de voos.</p>
</section><section id="exercícios-1" class="level3" data-number="12.4.4"><h3 data-number="12.4.4" class="anchored" data-anchor-id="exercícios-1">
<span class="header-section-number">12.4.4</span> Exercícios</h3>
<ol type="1">
<li>O que <code>sum(is.na(x))</code> retorna? E <code>mean(is.na(x))</code>?</li>
<li>O que <code><a href="https://rdrr.io/r/base/prod.html">prod()</a></code> retorna quando aplicada a um vetor lógico? Qual função de sumarização lógica é equivalente? O que <code><a href="https://rdrr.io/r/base/Extremes.html">min()</a></code> retorna quando aplicada a um vetor lógico? Qual função de sumarização lógica é equivalente? Leia a documentação e efetue alguns experimentos.</li>
</ol></section></section><section id="transformações-condicionais" class="level2" data-number="12.5"><h2 data-number="12.5" class="anchored" data-anchor-id="transformações-condicionais">
<span class="header-section-number">12.5</span> Transformações condicionais</h2>
<p>Uma das características mais poderosas de vetores lógico é seu uso em transformações condicionais, i.e.&nbsp;fazer alguma coisa em uma condição x, e alguma outra coisa diferente para a y. Existem duas funções importantes para isso: <code><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else()</a></code> e <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code>.</p>
<section id="if_else" class="level3" data-number="12.5.1"><h3 data-number="12.5.1" class="anchored" data-anchor-id="if_else">
<span class="header-section-number">12.5.1</span> <code>if_else()</code>
</h3>
<p>Se você quiser usar um valor para quando a condição é <code>TRUE</code> e outro valor para quando a condição é <code>FALSE</code>, você pode usar <code><a href="https://dplyr.tidyverse.org/reference/if_else.html">dplyr::if_else()</a></code><a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>. Você sempre usará os primeiros três argumentos de <code><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else()</a></code>. O primeiro, <code>condition</code>, é um vetor lógico, o segundo, <code>true</code>, gera uma saída quando a condição é verdadeira, e o terceiro, <code>false</code>, gera uma saída quando a condição é falsa.</p>
<p>Vamos começar com um simples exemplo rotulando um vetor numérico como “+vo” (positivo) ou “-vo” (negativo):</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span><span class="op">:</span><span class="fl">3</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="st">"+vo"</span>, <span class="st">"-vo"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "-vo" "-vo" "-vo" "-vo" "+vo" "+vo" "+vo" NA</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Há um quarto argumento opcional, <code>missing</code> o qual pode ser usado se a entrada for um valor <code>NA</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="st">"+vo"</span>, <span class="st">"-vo"</span>, <span class="st">"???"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "-vo" "-vo" "-vo" "-vo" "+vo" "+vo" "+vo" "???"</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Você também usar vetores para os argumentos <code>true</code> e <code>false</code>. Por exemplo, isto nos permite criar uma implementação mínima de <code><a href="https://rdrr.io/r/base/MathFun.html">abs()</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="op">-</span><span class="va">x</span>, <span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  3  2  1  0  1  2  3 NA</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Até agora, todos os argumentos usaram os mesmos vetores, mas você pode misturar e combinar variáveis. Por exemplo, você pode implementar uma versão simples de <code><a href="https://dplyr.tidyverse.org/reference/coalesce.html">coalesce()</a></code> desta forma:</p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="va">y1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="cn">NA</span>, <span class="fl">4</span>, <span class="fl">6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span>, <span class="va">y1</span>, <span class="va">x1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3 1 2 6</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Você pode notar uma pequena infelicidade no nosso exemplo de rótulo acima: zero não é nem positivo nem negativo. Nós poderíamos resolver isso adicionando um novo <code><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else()</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="fl">0</span>, <span class="st">"0"</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="st">"-vo"</span>, <span class="st">"+vo"</span><span class="op">)</span>, <span class="st">"???"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "-vo" "-vo" "-vo" "0"   "+vo" "+vo" "+vo" "???"</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Isto já é um pouco difícil de ler, mas você pode imaginar como se tornaria mais difícil se você tiver ainda mais condições. Ao invés disso, você deve mudar para o <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">dplyr::case_when()</a></code>.</p>
</section><section id="case_when" class="level3" data-number="12.5.2"><h3 data-number="12.5.2" class="anchored" data-anchor-id="case_when">
<span class="header-section-number">12.5.2</span> <code>case_when()</code>
</h3>
<p>O <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> do pacote dplyr é inspirado na declaração <code>CASE</code> do SQL e oferece uma forma flexível de efetuar diferentes cálculos para diferentes condições. Infelizmente, ele tem uma sintaxe que não se parece com nada que você usará no pacote tidyverse. Ele recebe pares que se parecem com <code>condição ~ saída</code>. <code>condição</code> deve ser um vetor lógico; quando for <code>TRUE</code>, <code>saída</code> será usada.</p>
<p>Isto significa que poderíamos recriar nos <code><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else()</a></code> aninhado desta forma:</p>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span><span class="op">:</span><span class="fl">3</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span> <span class="op">==</span> <span class="fl">0</span>   <span class="op">~</span> <span class="st">"0"</span>,</span>
<span>  <span class="va">x</span> <span class="op">&lt;</span> <span class="fl">0</span>    <span class="op">~</span> <span class="st">"-vo"</span>, </span>
<span>  <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span>    <span class="op">~</span> <span class="st">"+vo"</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">~</span> <span class="st">"???"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "-vo" "-vo" "-vo" "0"   "+vo" "+vo" "+vo" "???"</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>O código é maior, mas também é mais explícito.</p>
<p>Para explicar com <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> funciona, vamos explorar alguns casos mais simples. Se nenhum dos casos corresponder, a saída será <code>NA</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"-vo"</span>,</span>
<span>  <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"+vo"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "-vo" "-vo" "-vo" NA    "+vo" "+vo" "+vo" NA</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Use o argumento <code>.default</code> se você quiser gerar um “padrão”/pegar todos os valores:</p>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"-vo"</span>,</span>
<span>  <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"+vo"</span>,</span>
<span>  .default <span class="op">=</span> <span class="st">"???"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "-vo" "-vo" "-vo" "???" "+vo" "+vo" "+vo" "???"</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>E observe que se várias condições corresponderem, apenas a primeira será usada:</p>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"+vo"</span>,</span>
<span>  <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">2</span> <span class="op">~</span> <span class="st">"grande"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] NA    NA    NA    NA    "+vo" "+vo" "+vo" NA</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Assim como com <code><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else()</a></code> você pode usar variáveis ​​em ambos os lados do <code>~</code> e pode misturar e combinar variáveis ​​conforme necessário para o seu problema. Por exemplo, poderíamos usar <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> para fornecer alguns rótulos legíveis para o atraso de chegada:</p>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">voos</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    status <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">atraso_chegada</span><span class="op">)</span>      <span class="op">~</span> <span class="st">"cancelado"</span>,</span>
<span>      <span class="va">atraso_chegada</span> <span class="op">&lt;</span> <span class="op">-</span><span class="fl">30</span>       <span class="op">~</span> <span class="st">"muito antecipado"</span>,</span>
<span>      <span class="va">atraso_chegada</span> <span class="op">&lt;</span> <span class="op">-</span><span class="fl">15</span>       <span class="op">~</span> <span class="st">"antecipado"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">atraso_chegada</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">15</span>  <span class="op">~</span> <span class="st">"no horario"</span>,</span>
<span>      <span class="va">atraso_chegada</span> <span class="op">&lt;</span> <span class="fl">60</span>        <span class="op">~</span> <span class="st">"atrasado"</span>,</span>
<span>      <span class="va">atraso_chegada</span> <span class="op">&lt;</span> <span class="cn">Inf</span>       <span class="op">~</span> <span class="st">"muito atrasdo"</span>,</span>
<span>    <span class="op">)</span>,</span>
<span>    .keep <span class="op">=</span> <span class="st">"used"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 336,776 × 2</span></span>
<span><span class="co">#&gt;   atraso_chegada status    </span></span>
<span><span class="co">#&gt;            &lt;dbl&gt; &lt;chr&gt;     </span></span>
<span><span class="co">#&gt; 1             11 no horario</span></span>
<span><span class="co">#&gt; 2             20 atrasado  </span></span>
<span><span class="co">#&gt; 3             33 atrasado  </span></span>
<span><span class="co">#&gt; 4            -18 antecipado</span></span>
<span><span class="co">#&gt; 5            -25 antecipado</span></span>
<span><span class="co">#&gt; 6             12 no horario</span></span>
<span><span class="co">#&gt; # ℹ 336,770 more rows</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Tenha cuidado ao escrever esse tipo de instrução <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> complexa; minhas duas primeiras tentativas usaram uma mistura de <code>&lt;</code> e <code>&gt;</code> e continuei criando acidentalmente condições sobrepostas.</p>
</section><section id="tipos-compatíveis" class="level3" data-number="12.5.3"><h3 data-number="12.5.3" class="anchored" data-anchor-id="tipos-compatíveis">
<span class="header-section-number">12.5.3</span> Tipos compatíveis</h3>
<p>Observe que <code><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else()</a></code> e <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> requerem tipos <strong>compatíveis</strong> na saída. Se eles não forem compatíveis, você verá erros como este:</p>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="st">"a"</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in `if_else()`:</span></span>
<span><span class="co">#&gt; ! Can't combine `true` &lt;character&gt; and `false` &lt;double&gt;.</span></span>
<span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;</span> <span class="op">-</span><span class="fl">1</span> <span class="op">~</span> <span class="cn">TRUE</span>,  </span>
<span>  <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span>  <span class="op">~</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/now.html">now</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in `case_when()`:</span></span>
<span><span class="co">#&gt; ! Can't combine `..1 (right)` &lt;logical&gt; and `..2 (right)` &lt;datetime&lt;local&gt;&gt;.</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>No geral, relativamente poucos tipos são compatíveis, porque a conversão automática de um tipo de vetor em outro é uma fonte comum de erros. Aqui estão os casos mais importantes que são compatíveis:</p>
<ul>
<li>Vetores numéricos e lógicos são compatíveis, conforme discutimos na <a href="#sec-numeric-summaries-of-logicals" class="quarto-xref"><span>Seção 12.4.2</span></a>.</li>
<li>Strings e fatores (<a href="factors.html" class="quarto-xref"><span>Capítulo 16</span></a>) são compatíveis, porque você pode pensar em um fator como uma string com um conjunto restrito de valores.</li>
<li>Data e data-hora, que discutiremos no <a href="datetimes.html" class="quarto-xref"><span>Capítulo 17</span></a>, são compatíveis porque você pode pensar em uma data (<em>date</em>) como um caso especial de data-hora (<em>datetime</em>).</li>
<li>
<code>NA</code>, que é tecnicamente um vetor lógico, é compatível com tudo porque todo vetor tem alguma forma de representar um valor faltante (<em>missing value</em>).</li>
</ul>
<p>Não esperamos que você memorize essas regras, mas elas devem se tornar naturais com o tempo, porque são aplicadas de forma consistente em todo o tidyverse.</p>
</section><section id="exercícios-2" class="level3" data-number="12.5.4"><h3 data-number="12.5.4" class="anchored" data-anchor-id="exercícios-2">
<span class="header-section-number">12.5.4</span> Exercícios</h3>
<ol type="1">
<li><p>Um número é par se for divisível por dois, o que, no R, você pode descobrir com <code>x %% 2 == 0</code>. Use este fato e <code><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else()</a></code> para determinar se cada número entre 0 e 20 é par ou ímpar.</p></li>
<li><p>Dado um vetor de dias como <code>x &lt;- c("Segunda-feira", "Sábado", "Quarta-feira")</code>, use uma instrução <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> para rotulá-los como fins de semana ou dias de semana.</p></li>
<li><p>Use <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> para calcular o valor absoluto de um vetor numérico chamado <code>x</code>.</p></li>
<li><p>Escreva uma declaração <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> que usa as colunas <code>mes</code> e <code>dia</code> de <code>voos</code> para rotular um conjunto de feriados importante dos Brasil (e.g., 7 de Setembro, Tiradentes, Carnaval e Natal<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>). Primeiro crie uma coluna lógica <code>TRUE</code> ou <code>FALSE</code>, e então uma coluna texto (<em>character</em>) que tenha o nome do feriado ou <code>NA</code>.</p></li>
</ol></section></section><section id="resumo" class="level2" data-number="12.6"><h2 data-number="12.6" class="anchored" data-anchor-id="resumo">
<span class="header-section-number">12.6</span> Resumo</h2>
<p>A definição de vetor lógico é simples pois seu valor é <code>TRUE</code>, <code>FALSE</code> ou <code>NA</code>. Mas os vetores lógicos oferecem grande poder. Neste capítulo, você aprendeu a criar vetores lógicos com <code>&gt;</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;=</code>, <code>==</code>, <code>!=</code> e <code><a href="https://rdrr.io/r/base/NA.html">is.na()</a></code>, como combiná-los com <code>!</code>, <code>&amp;</code> e <code>|</code>, e como sumarizá-los com <code><a href="https://rdrr.io/r/base/any.html">any()</a></code>, <code><a href="https://rdrr.io/r/base/all.html">all()</a></code>, <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> e <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code>. Você também aprendeu as funções poderosas <code><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else()</a></code> e <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> que permitem você retornar valores dependendo do valor de um vetor lógico.</p>
<p>Veremos vetores lógicos cada vez mais nos próximos capítulos. Por exemplo, no <a href="strings.html" class="quarto-xref"><span>Capítulo 14</span></a> você vai aprender sobre <code>str_detect(x, pattern)</code> que retorna um vetor lógico que será <code>TRUE</code> para elementos de <code>x</code> que correnpondem ao <code>pattern</code> (padrão), e no <a href="datetimes.html" class="quarto-xref"><span>Capítulo 17</span></a> você irá criar vetores lógicos a partir de comparações de datas e horários. Por ora, iremos para o próximo mais importante tipo de vetores: vetores numéricos.</p>


</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>R normalmente chama <em>print</em> para você (ex. <code>x</code> é um atalho para <code>print(x)</code>), mas chamando-o explicitamente é útil se você quer fornecer outros argumentos.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Isto é, <code>xor(x, y)</code> é verdadeiro se x for verdadeiro, ou y for verdadeiro, mas nunca ambos. Isto é como usamos “ou” em Português. “Ambos” geralmente não é uma resposta aceitável quando respondemos a pergunta “Você gostaria de sorvete ou bolo?”.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Iremos cobrir isto na <a href="joins.html" class="quarto-xref"><span>Capítulo 19</span></a>.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>A função <code><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else()</a></code> do dplyr é muito similar a <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> do R base . Existem duas vantagens principais do <code><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else()</a></code> sobre <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code>: você pode escolher o que acontece com valor faltantes (<em>missing values</em>) e <code><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else()</a></code> te retorna erros com mais sentido se sua variável possuir tipos incompatíveis.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p><strong>Nota de tradução:</strong> Na versão original em inglês, os feriados são dos Estados Unidos.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiada");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiada");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./transform.html" class="pagination-link  aria-label=" transformar="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">✅ Transformar</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./numbers.html" class="pagination-link" aria-label="<span class='chapter-number'>13</span>&nbsp; <span class='chapter-title'>✅ Números</span>">
        <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">✅ Números</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>R para Ciência de Dados (2ª edição) foi escrito por Hadley Wickham, Mine Çetinkaya-Rundel, e Garrett Grolemund.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/cienciadedatos/pt-r4ds/edit/main/logicals.qmd" class="toc-action"><i class="bi bi-github"></i>Editar essa página</a></li><li><a href="https://github.com/cienciadedatos/pt-r4ds/issues/new" class="toc-action"><i class="bi empty"></i>Criar uma issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Este livro foi contruído com <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>


</body></html>